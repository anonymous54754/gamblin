<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>S SUPER 9 BET</title>
<style>
body{background:#0a0a0a;color:#eee;font-family:sans-serif}
.btn{padding:12px 20px;font-weight:900;cursor:pointer}
.admin{color:gold;font-weight:900}
</style>
</head>
<body>

<h1>S SUPER 9 BET</h1>
ë³´ìœ ë¨¸ë‹ˆ: <span id="assetVal">0</span>
<span id="adminBadge" class="admin"></span>

<hr>

<h2>ğŸ° SLOT</h2>
<div id="reels">â“ | â“ | â“</div>
<input id="slotBet" value="10000">
<button class="btn" onclick="playSlot()">SPIN</button>

<hr>

<h2>ğŸŒ SNAIL</h2>
<input type="radio" name="snailPick" value="0" checked>1
<input type="radio" name="snailPick" value="1">2
<input type="radio" name="snailPick" value="2">3
<br>
<input id="snailBet" value="10000">
<button class="btn" onclick="playSnail()">START</button>

<hr>

<h2>ğŸƒ BACCARAT</h2>
<input id="bacBet" value="10000"><br>
<button onclick="playBac('player')">PLAYER</button>
<button onclick="playBac('tie')">TIE</button>
<button onclick="playBac('banker')">BANKER</button>

<hr>

<h2>ğŸ“¨ ê³ ê°ì„¼í„°</h2>
<table id="csTable"></table>

<!-- sounds -->
<audio id="sndSpin" src="https://assets.mixkit.co/sfx/preview/mixkit-slot-machine-spin-1930.mp3"></audio>
<audio id="sndSlotResult" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>
<audio id="sndCard" src="https://assets.mixkit.co/sfx/preview/mixkit-card-flip-2000.mp3"></audio>
<audio id="sndSnail" src="https://assets.mixkit.co/sfx/preview/mixkit-game-level-completed-2059.mp3"></audio>
<audio id="sndWin" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
<audio id="sndLose" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-lose-2027.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
import { getFirestore,doc,getDoc,updateDoc,increment,collection,getDocs,deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

const app = initializeApp({
 apiKey:"AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4",
 authDomain:"gambling-23339.firebaseapp.com",
 projectId:"gambling-23339"
});
const auth=getAuth(app),db=getFirestore(app);

let curBal=0,isAdmin=false,uid=null;

const play=id=>document.getElementById(id).play();

onAuthStateChanged(auth,async u=>{
 if(!u)return;
 uid=u.uid;
 const snap=await getDoc(doc(db,"users",uid));
 curBal=snap.data().balance;
 isAdmin=snap.data().role==="admin";
 document.getElementById("assetVal").innerText=curBal;
 if(isAdmin) document.getElementById("adminBadge").innerText="[ADMIN]";
 loadCS();
});

async function payout(bet,mul){
 const profit=Math.floor(bet*mul-bet);
 await updateDoc(doc(db,"users",uid),{balance:increment(profit)});
 curBal+=profit;
 document.getElementById("assetVal").innerText=curBal;
 play(profit>0?"sndWin":"sndLose");
}

window.playSlot=async()=>{
 const bet=+slotBet.value;
 play("sndSpin");
 setTimeout(async()=>{
  const syms=['ğŸ','ğŸŠ','ğŸ‡','7ï¸âƒ£'];
  const r=[syms[Math.random()*4|0],syms[Math.random()*4|0],syms[Math.random()*4|0]];
  reels.innerText=r.join(" | ");
  play("sndSlotResult");

  let mul=0;
  if(r[0]==='7ï¸âƒ£'&&r[1]==='7ï¸âƒ£'&&r[2]==='7ï¸âƒ£') mul=17.7;
  else if(r.filter(x=>x==='7ï¸âƒ£').length===2) mul=4;
  else if(new Set(r).size===2) mul=3;

  await payout(bet,mul);
 },1500);
};

window.playSnail=async()=>{
 const bet=+snailBet.value;
 play("sndSnail");
 const win=Math.random()*3|0;
 const pick=+document.querySelector("[name=snailPick]:checked").value;
 await payout(bet,win===pick?2.8:0);
};

window.playBac=async(pick)=>{
 const bet=+bacBet.value;
 play("sndCard");
 const r=['player','banker','tie'][Math.random()*3|0];
 const mul=(r===pick)?(r==='tie'?9.8:2.8):0;
 await payout(bet,mul);
};

async function loadCS(){
 const snap=await getDocs(collection(db,"cs"));
 csTable.innerHTML="";
 snap.forEach(d=>{
  const row=document.createElement("tr");
  row.innerHTML=`<td>${d.data().title}</td>
  <td>${isAdmin?d.data().content:"ë¹„ë°€ê¸€"}</td>
  ${isAdmin?`<td><button onclick="delCS('${d.id}')">ì‚­ì œ</button></td>`:""}`;
  csTable.appendChild(row);
 });
}
window.delCS=async(id)=>{
 if(confirm("ì‚­ì œ")){
  await deleteDoc(doc(db,"cs",id));
  loadCS();
 }
};
</script>
</body>
</html>

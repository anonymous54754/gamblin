<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S SUPER 9 BET | PREMIERE LIVE</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main-green: #2e7d32; --point-gold: #eebb4d; --bg-dark: #0a0a0a; --card-w: 75px; --card-h: 110px; }
        body { background-color: var(--bg-dark); color: #eee; font-family: 'Noto Sans KR', sans-serif; margin: 0; overflow-x: hidden; }
        
        /* í—¤ë” & ìì‚° í‘œì‹œ */
        .top-nav { background: linear-gradient(180deg, #4caf50 0%, #1b5e20 100%); height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); position: sticky; top:0; z-index: 1000; }
        .logo { font-size: 24px; font-weight: 900; font-style: italic; color: #fff; cursor: pointer; }
        .user-assets { background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--point-gold); font-weight: bold; color: var(--point-gold); }

        /* ë ˆì´ì•„ì›ƒ */
        .main-container { display: flex; min-height: 90vh; }
        .sidebar { width: 220px; background: #111; border-right: 1px solid #222; padding: 20px 0; }
        .menu-item { padding: 15px 25px; cursor: pointer; font-size: 15px; border-left: 4px solid transparent; transition: 0.2s; }
        .menu-item:hover, .menu-active { background: #1a1a1a; border-left: 4px solid var(--point-gold); color: var(--point-gold); }
        .content { flex: 1; padding: 25px; background: #151515; }

        /* ê´‘ê³  ë°°ë„ˆ */
        .ads-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px; }
        .ad-card { height: 100px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 900; text-align: center; border: 2px solid #333; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { border-color: #555; } 50% { border-color: var(--point-gold); box-shadow: 0 0 10px var(--point-gold); } }

        /* ë°”ì¹´ë¼ ì¹´ë“œ ë’¤ì§‘ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        .bac-table { background: radial-gradient(circle, #12522d 0%, #052210 100%); border: 8px solid #3d2b1f; border-radius: 100px; padding: 40px; display: flex; justify-content: center; gap: 40px; margin-bottom: 20px; }
        .card-slot { width: var(--card-w); height: var(--card-h); perspective: 1000px; position: relative; display: inline-block; margin: 0 5px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 5px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }
        .card-back { background: url('https://deckofcardsapi.com/static/img/back.png') center/cover; }
        .card-front { background-size: cover; transform: rotateY(180deg); }
        .is-flipped { transform: rotateY(180deg); }

        /* ë‹¬íŒ½ì´ ë ˆì´ìŠ¤ */
        #snailCanvas { background: #4e342e; border: 4px solid #3e2723; border-radius: 10px; display: block; margin: 0 auto; width: 100%; max-width: 600px; }

        /* ê³µí†µ UI */
        .panel { background: #1e1e1e; border: 1px solid #333; padding: 20px; border-radius: 10px; }
        .btn-bet { background: var(--point-gold); color: #000; border: none; padding: 12px 20px; font-weight: 900; cursor: pointer; border-radius: 5px; width: 100%; margin-top: 10px; }
        input { background: #000; border: 1px solid #444; color: var(--point-gold); padding: 10px; width: 100%; box-sizing: border-box; font-weight: bold; border-radius: 4px; }
        
        /* ë¡œê·¸ì¸/ë§ˆì´í˜ì´ì§€/CS */
        #loginOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:flex; justify-content:center; align-items:center; z-index:9999; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { padding: 12px; border-bottom: 1px solid #222; text-align: left; }
        .view { display: none; }
        .active-view { display: block; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div style="background:#1a1a1a; padding:40px; border:2px solid var(--main-green); border-radius:15px; width:320px; text-align:center;">
            <h2 style="color:var(--main-green); margin-bottom:30px;">SUPER 9 BET</h2>
            <input type="email" id="loginEmail" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" style="margin-bottom:10px;">
            <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸" style="margin-bottom:20px;">
            <button class="btn-bet" onclick="login()">ë¡œê·¸ì¸</button>
        </div>
    </div>

    <div class="top-nav">
        <div class="logo" onclick="showView('mainHome')">S SUPER 9 BET</div>
        <div class="user-assets">ë³´ìœ ê¸ˆ: <span id="assetBalance">0</span> KRW</div>
        <div class="nav-links" style="color:#fff; font-size:13px; font-weight:bold;">
            <span onclick="showView('myPage')" style="cursor:pointer; margin-right:15px;">ë§ˆì´í˜ì´ì§€</span>
            <span onclick="showView('csCenter')" style="cursor:pointer; margin-right:15px;">ê³ ê°ì„¼í„°</span>
            <span onclick="logout()" style="cursor:pointer; color:#ff5252;">ë¡œê·¸ì•„ì›ƒ</span>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="menu-item menu-active" onclick="showView('mainHome')">ğŸ  ë©”ì¸ ë¡œë¹„</div>
            <div class="menu-item" onclick="showView('slotGame')">ğŸ° 777 ìŠ¬ë¡¯</div>
            <div class="menu-item" onclick="showView('bacGame')">ğŸƒ VIP ë°”ì¹´ë¼</div>
            <div class="menu-item" onclick="showView('snailGame')">ğŸŒ ë‹¬íŒ½ì´ ë ˆì´ìŠ¤</div>
        </div>

        <div class="content">
            <div id="mainHome" class="view active-view">
                <div class="ads-container">
                    <div class="ad-card" style="background:#300; color:#ff5252;">[ì´ë²¤íŠ¸] 777 ìŠ¬ë¡¯<br>ì­íŒŸ 17.7ë°° ìƒí–¥!</div>
                    <div class="ad-card" style="background:#003; color:#4facfe;">[VIP] ë°”ì¹´ë¼ íƒ€ì´<br>ì ì¤‘ ì‹œ 10ë°° ì§€ê¸‰!</div>
                    <div class="ad-card" style="background:#330; color:#ffeb3b;">[ì‹ ê·œ] ë‹¬íŒ½ì´ ë ˆì´ìŠ¤<br>ì‹¤ì‚¬ ëª¨ë“œ ì—…ë°ì´íŠ¸!</div>
                </div>
                <div class="panel">
                    <h3>ğŸ“¢ ì‹¤ì‹œê°„ ê³µì§€</h3>
                    <p style="color:#888;">- ë†í˜‘ì€í–‰ ì ê²€ìœ¼ë¡œ ì¸í•œ ì…ê¸ˆ ì§€ì—° ì•ˆë‚´</p>
                    <p style="color:#888;">- bugye6816*** ê´€ë¦¬ìë‹˜ì´ ì…ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.</p>
                </div>
            </div>

            <div id="slotGame" class="view">
                <div class="panel" style="text-align:center;">
                    <h2 style="color:var(--point-gold)">LUCKY FRUITS SLOTS</h2>
                    <div id="reels" style="font-size:60px; margin:30px 0; background:#000; padding:20px; border-radius:10px;">ğŸ’ | ğŸ’ | ğŸ’</div>
                    <input type="number" id="slotBet" value="10000" style="width:200px; margin-bottom:15px;">
                    <button class="btn-bet" style="width:200px;" onclick="playSlot()">SPIN START</button>
                </div>
            </div>

            <div id="bacGame" class="view">
                <div class="panel" style="text-align:center;">
                    <h2 style="color:#fff;">REAL CARD BACCARAT</h2>
                    <div class="bac-table">
                        <div>
                            <p style="color:#4facfe; font-weight:bold;">PLAYER</p>
                            <div id="pCard1" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                            <div id="pCard2" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                        </div>
                        <div>
                            <p style="color:#ff5252; font-weight:bold;">BANKER</p>
                            <div id="bCard1" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                            <div id="bCard2" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                        </div>
                    </div>
                    <input type="number" id="bacBet" value="10000" style="width:200px; margin-bottom:15px;">
                    <div style="display:flex; justify-content:center; gap:10px;">
                        <button class="btn-bet" style="width:120px; background:#4facfe;" onclick="playBac('player')">P (2x)</button>
                        <button class="btn-bet" style="width:120px; background:#4caf50;" onclick="playBac('tie')">T (10x)</button>
                        <button class="btn-bet" style="width:120px; background:#ff5252;" onclick="playBac('banker')">B (2x)</button>
                    </div>
                </div>
            </div>

            <div id="snailGame" class="view">
                <div class="panel" style="text-align:center;">
                    <h2>REAL SNAIL RACING</h2>
                    <canvas id="snailCanvas" width="600" height="200"></canvas>
                    <div style="margin:20px 0;">
                        <label><input type="radio" name="spick" value="0" checked> 1ë²ˆ</label>
                        <label><input type="radio" name="spick" value="1" style="margin-left:20px;"> 2ë²ˆ</label>
                        <label><input type="radio" name="spick" value="2" style="margin-left:20px;"> 3ë²ˆ</label>
                    </div>
                    <input type="number" id="snailBet" value="10000" style="width:200px; margin-bottom:10px;">
                    <button class="btn-bet" style="width:200px;" onclick="playSnail()">RACE START</button>
                </div>
            </div>

            <div id="myPage" class="view">
                <h2>ë‚´ ë² íŒ… ì •ë³´</h2>
                <div class="panel">
                    <p>ì•„ì´ë””: <span id="infoEmail">-</span></p>
                    <p>ê°€ì…ì¼: <span id="infoJoin">-</span></p>
                    <hr style="border:0; border-top:1px solid #333; margin:20px 0;">
                    <h4>ìµœê·¼ 10ê²½ê¸° ê¸°ë¡</h4>
                    <table id="historyTable">
                        <thead><tr><th>ê²Œì„</th><th>ë°°íŒ…ê¸ˆ</th><th>ìˆ˜ìµ</th><th>ì‹œê°„</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="csCenter" class="view">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2>1:1 ë¬¸ì˜ì„¼í„°</h2>
                    <span id="adminBadge" style="display:none; color:var(--point-gold); border:1px solid var(--point-gold); padding:2px 8px; border-radius:4px; font-size:12px;">ADMIN ê¶Œí•œ</span>
                </div>
                <div class="panel">
                    <div id="csWrite">
                        <input type="text" id="csTitle" placeholder="ì œëª©" style="margin-bottom:10px;">
                        <textarea id="csContent" style="width:100%; height:80px; background:#000; color:#fff; border:1px solid #444; padding:10px; border-radius:4px; margin-bottom:10px;"></textarea>
                        <label><input type="checkbox" id="csSecret"> ë¹„ê³µê°œ ë¬¸ì˜</label>
                        <button class="btn-bet" style="width:120px; float:right;" onclick="writeCS()">ë¬¸ì˜ë“±ë¡</button>
                    </div>
                    <div style="clear:both;"></div>
                    <table id="csTable">
                        <thead><tr><th>ìƒíƒœ</th><th>ì œëª©</th><th>ì‘ì„±ì</th><th>ì‹œê°„</th><th>ê´€ë¦¬</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, arrayUnion, collection, addDoc, getDocs, query, orderBy, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4", authDomain: "gambling-23339.firebaseapp.com", projectId: "gambling-23339", storageBucket: "gambling-23339.firebasestorage.app", messagingSenderId: "1031894079454", appId: "1:1031894079454:web:960ca0f1748493cdd9af4f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userObj = null;
        let isAdmin = false;

        // --- Auth ---
        window.login = async () => {
            const email = document.getElementById('loginEmail').value;
            const pw = document.getElementById('loginPw').value;
            try { await signInWithEmailAndPassword(auth, email, pw); } catch(e) { alert("ë¡œê·¸ì¸ ì‹¤íŒ¨"); }
        };
        window.logout = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, async (user) => {
            if(user) {
                userObj = user;
                isAdmin = (user.email === 'bugye6816@gmail.com');
                document.getElementById('loginOverlay').style.display = 'none';
                if(isAdmin) document.getElementById('adminBadge').style.display = 'block';
                refreshAssets();
                loadCS();
            } else {
                document.getElementById('loginOverlay').style.display = 'flex';
            }
        });

        window.showView = (id) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('menu-active'));
            document.getElementById(id).classList.add('active-view');
            if(id === 'snailGame') initSnail();
            if(id === 'myPage') loadMyPage();
            refreshAssets();
        };

        async function refreshAssets() {
            if(!userObj) return;
            const snap = await getDoc(doc(db, "users", userObj.uid));
            const bal = snap.data().balance;
            document.getElementById('assetBalance').innerText = bal.toLocaleString();
            return bal;
        }

        // --- ë°”ì¹´ë¼ (ë¦¬ì–¼ ì¹´ë“œ & ëª¨ì…˜) ---
        window.playBac = async (pick) => {
            const bet = parseInt(document.getElementById('bacBet').value);
            const bal = await refreshAssets();
            if(bal < bet) return alert("ì”ì•¡ ë¶€ì¡±");

            // ì´ˆê¸°í™”
            const slots = ['pCard1', 'pCard2', 'bCard1', 'bCard2'];
            slots.forEach(s => document.querySelector(`#${s} .card-inner`).classList.remove('is-flipped'));
            
            await new Promise(r => setTimeout(r, 500)); // ì •ë¦¬ ì‹œê°„

            const getCard = () => {
                const num = Math.floor(Math.random()*13)+1;
                const suit = ['H','S','D','C'][Math.floor(Math.random()*4)];
                let val = num > 10 ? 0 : (num === 1 ? 1 : num);
                let code = num;
                if(num === 1) code = 'A'; else if(num === 11) code = 'J'; else if(num === 12) code = 'Q'; else if(num === 13) code = 'K';
                if(num === 10) code = '0';
                return { val, url: `https://deckofcardsapi.com/static/img/${code}${suit}.png` };
            };

            const p1 = getCard(), p2 = getCard(), b1 = getCard(), b2 = getCard();
            const cards = [p1, b1, p2, b2];

            for(let i=0; i<4; i++) {
                const target = document.querySelector(`#${slots[i]} .card-front`);
                target.style.backgroundImage = `url(${cards[i].url})`;
                document.querySelector(`#${slots[i]} .card-inner`).classList.add('is-flipped');
                await new Promise(r => setTimeout(r, 700)); // ë”œë§ ì§€ì—°
            }

            const pScore = (p1.val + p2.val) % 10;
            const bScore = (b1.val + b2.val) % 10;
            const res = pScore > bScore ? 'player' : (bScore > pScore ? 'banker' : 'tie');
            const multi = (pick === res) ? (res === 'tie' ? 10 : 2) : 0;
            const profit = (bet * multi) - bet;

            await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit), history: arrayUnion({ game: 'ë°”ì¹´ë¼', bet, profit, time: new Date().toISOString() }) });
            refreshAssets();
            alert(`[ê²°ê³¼] í”Œë ˆì´ì–´ ${pScore} : ë±…ì»¤ ${bScore} -> ${res.toUpperCase()} ìŠ¹ë¦¬!`);
        };

        // --- ë‹¬íŒ½ì´ (ì‹¤ì‚¬ & ì €ì†) ---
        const snailImg = new Image(); 
        snailImg.src = "https://cdn-icons-png.flaticon.com/512/826/826912.png"; // ì‹¤ì‚¬ ëŠë‚Œ ì´ë¯¸ì§€
        let snailX = [10, 10, 10];

        window.initSnail = () => {
            const ctx = document.getElementById('snailCanvas').getContext('2d');
            function draw() {
                ctx.fillStyle = "#4e342e"; ctx.fillRect(0,0,600,200);
                ctx.strokeStyle = "#3e2723"; 
                for(let i=1; i<3; i++){ ctx.beginPath(); ctx.moveTo(0, i*66); ctx.lineTo(600, i*66); ctx.stroke(); }
                ctx.fillStyle = "#eebb4d"; ctx.fillRect(570, 0, 5, 200); // Finish Line
                snailX.forEach((x, i) => ctx.drawImage(snailImg, x, i*66 + 10, 45, 45));
                requestAnimationFrame(draw);
            }
            draw();
        };

        window.playSnail = async () => {
            const bet = parseInt(document.getElementById('snailBet').value);
            const pick = parseInt(document.querySelector('input[name="spick"]:checked').value);
            const bal = await refreshAssets();
            if(bal < bet) return alert("ì”ì•¡ ë¶€ì¡±");

            const race = setInterval(async () => {
                let win = -1;
                snailX = snailX.map((x, i) => {
                    const nx = x + Math.random() * 2.2; // ì†ë„ í•˜í–¥ ì¡°ì ˆ (ê¸°ì¡´ 5 -> 2.2)
                    if(nx >= 530) win = i;
                    return nx;
                });
                if(win !== -1) {
                    clearInterval(race);
                    const isWin = win === pick;
                    const profit = isWin ? Math.floor(bet * 2.9) - bet : -bet;
                    await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit), history: arrayUnion({ game: 'ë‹¬íŒ½ì´', bet, profit, time: new Date().toISOString() }) });
                    alert(`${win+1}ë²ˆ ë‹¬íŒ½ì´ ìš°ìŠ¹!`);
                    snailX = [10, 10, 10]; refreshAssets();
                }
            }, 30);
        };

        // --- ìŠ¬ë¡¯ (777 ì­íŒŸ 17.7ë°°) ---
        const syms = ['ğŸ','ğŸŠ','ğŸ‡','ğŸ’','ğŸ’','7ï¸âƒ£','ğŸ‰','ğŸ‹','ğŸ’°'];
        window.playSlot = async () => {
            const bet = parseInt(document.getElementById('slotBet').value);
            if(await refreshAssets() < bet) return alert("ì”ì•¡ ë¶€ì¡±");
            
            const r = [syms[Math.floor(Math.random()*9)], syms[Math.floor(Math.random()*9)], syms[Math.floor(Math.random()*9)]];
            document.getElementById('reels').innerText = r.join(' | ');
            
            let multi = 0;
            if(r[0] === r[1] && r[1] === r[2]) multi = (r[0] === '7ï¸âƒ£') ? 17.7 : 5;
            else if(r[0] === r[1] || r[1] === r[2] || r[0] === r[2]) multi = 1;

            const profit = Math.floor(bet * multi) - bet;
            await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit), history: arrayUnion({ game:'ìŠ¬ë¡¯', bet, profit, time: new Date().toISOString() }) });
            refreshAssets();
        };

        // --- ë§ˆì´í˜ì´ì§€ & CS ---
        async function loadMyPage() {
            const snap = await getDoc(doc(db, "users", userObj.uid));
            const d = snap.data();
            document.getElementById('infoEmail').innerText = userObj.email;
            document.getElementById('infoJoin').innerText = d.joinDate || '2025-01-01';
            document.getElementById('historyTable').querySelector('tbody').innerHTML = (d.history || []).slice(-10).reverse().map(h => `
                <tr><td>${h.game}</td><td>${h.bet}</td><td style="color:${h.profit>=0?'#4caf50':'#ff5252'}">${h.profit}</td><td>${h.time.slice(11,16)}</td></tr>
            `).join('');
        }

        window.writeCS = async () => {
            const title = document.getElementById('csTitle').value;
            const content = document.getElementById('csContent').value;
            const secret = document.getElementById('csSecret').checked;
            await addDoc(collection(db, "cs"), { uid: userObj.uid, email: userObj.email, title, content, secret, time: new Date().toISOString() });
            loadCS();
        };

        window.delCS = async (id) => { if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { await deleteDoc(doc(db, "cs", id)); loadCS(); } };

        async function loadCS() {
            const q = query(collection(db, "cs"), orderBy("time", "desc"));
            const snap = await getDocs(q);
            document.querySelector('#csTable tbody').innerHTML = snap.docs.map(docSnap => {
                const d = docSnap.data();
                const canSee = !d.secret || d.uid === userObj.uid || isAdmin;
                return `<tr>
                    <td>${d.secret ? 'ğŸ”’' : 'ğŸ“¢'}</td>
                    <td onclick="alert('${canSee ? d.content : 'ë¹„ë°€ê¸€ì…ë‹ˆë‹¤'}')" style="cursor:pointer">${canSee ? d.title : 'ë¹„ë°€ê¸€ì…ë‹ˆë‹¤'}</td>
                    <td>${d.email.split('@')[0]}</td>
                    <td>${d.time.slice(5,10)}</td>
                    <td>${isAdmin ? `<button onclick="delCS('${docSnap.id}')">ì‚­ì œ</button>` : '-'}</td>
                </tr>`;
            }).join('');
        }
    </script>
</body>
</html>
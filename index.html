<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOLDEN ROYAL CASINO</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@300;900&display=swap" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        // ðŸ”¥ ë³¸ì¸ì˜ Firebase ì„¤ì •ê°’ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
        const firebaseConfig = {
  apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4",
  authDomain: "gambling-23339.firebaseapp.com",
  projectId: "gambling-23339",
  storageBucket: "gambling-23339.firebasestorage.app",
  messagingSenderId: "1031894079454",
  appId: "1:1031894079454:web:960ca0f1748493cdd9af4f",
  measurementId: "G-GT74F5GVR2"
};
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userDoc = null;
        let userData = { balance: 0, nickname: "", role: "user", history: [] };

        window.showView = async (viewId) => {
            if (viewId === 'baccaratGame' && document.getElementById('baccaratGame').style.display === 'none') {
                if (!confirm("ì£¼ì˜: ì‹¤ì œ ì¹´ì§€ë…¸ ê·œì¹™ì´ ì ìš©ë©ë‹ˆë‹¤. ìž…ìž¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            }
            document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
            document.getElementById(viewId).style.display = 'block';
            if (userDoc) {
                const snap = await getDoc(userDoc);
                userData = snap.data();
                updateUI();
            }
            if (viewId === 'snailGame') drawSnailRace();
        };

        function updateUI() {
            document.querySelectorAll('.balance-txt').forEach(el => el.innerText = (userData.balance || 0).toLocaleString());
            if(document.getElementById('lobby-nick')) document.getElementById('lobby-nick').innerText = userData.nickname;
            
            const historyBody = document.getElementById('historyBody');
            if (historyBody && userData.history) {
                historyBody.innerHTML = userData.history.slice().reverse().map(h => `
                    <tr>
                        <td>${h.game.toUpperCase()}</td>
                        <td>${h.bet}</td>
                        <td>${h.result}</td>
                        <td class="${h.profit >= 0 ? 'plus' : 'minus'}">${h.profit >= 0 ? '+' : ''}${h.profit.toLocaleString()}</td>
                    </tr>
                `).join('');
            }
            if(userData.role === 'admin') document.getElementById('admin-btn').style.display = 'block';
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userDoc = doc(db, "users", user.uid);
                const snap = await getDoc(userDoc);
                userData = snap.data();
                updateUI();
                showView('lobby');
            } else {
                showView('login');
            }
        });

        window.handleAuth = async (mode) => {
            const email = document.getElementById('email').value;
            const pw = document.getElementById('pw').value;
            const nick = document.getElementById('nickname').value;
            try {
                if (mode === 'signup') {
                    const res = await createUserWithEmailAndPassword(auth, email, pw);
                    await setDoc(doc(db, "users", res.user.uid), { nickname: nick || "USER", balance: 100000, role: "user", history: [] });
                } else {
                    await signInWithEmailAndPassword(auth, email, pw);
                }
            } catch (e) { alert("Access Denied: " + e.message); }
        };

        async function updatePoints(profit, gameType, betInfo, resultInfo) {
            await updateDoc(userDoc, {
                balance: increment(profit),
                history: arrayUnion({
                    game: gameType,
                    bet: betInfo,
                    result: resultInfo,
                    profit: profit,
                    time: new Date().toISOString()
                })
            });
            const snap = await getDoc(userDoc);
            userData = snap.data();
            updateUI();
        }

        // --- SNAIL RACE (Professional Version) ---
        let isRacing = false;
        function drawSnailRace(positions = [60, 60, 60]) {
            const canvas = document.getElementById('snailCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0,0,800,400);
            
            // Track Grid
            ctx.strokeStyle = "#333";
            for(let i=0; i<4; i++) {
                ctx.beginPath(); ctx.moveTo(0, i*100); ctx.lineTo(800, i*100); ctx.stroke();
            }

            // Finish Line Neon
            ctx.shadowBlur = 15;
            ctx.shadowColor = "#ff0000";
            ctx.fillStyle = "#ff0000";
            ctx.fillRect(740, 0, 10, 400);
            ctx.shadowBlur = 0;

            const colors = ["#FFD700", "#C0C0C0", "#CD7F32"]; // Gold, Silver, Bronze
            for(let i=0; i<3; i++) {
                const y = 50 + i*100;
                // Racer Body
                ctx.fillStyle = "#111";
                ctx.fillRect(positions[i]-40, y-20, 80, 40);
                ctx.strokeStyle = colors[i];
                ctx.lineWidth = 3;
                ctx.strokeRect(positions[i]-40, y-20, 80, 40);
                
                ctx.fillStyle = colors[i];
                ctx.font = "bold 16px Oswald";
                ctx.fillText(`NO.${i+1} RACER`, positions[i]-35, y+5);
            }
        }

        window.startSnailRace = async () => {
            const bet = parseInt(document.getElementById('snail-bet').value);
            if(isRacing || bet > userData.balance || bet <= 0) return;
            isRacing = true;
            document.getElementById('snail-start-btn').disabled = true;
            await updatePoints(-bet, 'snail', 'BETTING', 'RACING...');

            let positions = [60, 60, 60];
            let winner = null;
            while(!winner) {
                for(let i=0; i<3; i++) {
                    positions[i] += Math.random() * 9 + 3;
                    if(positions[i] >= 740) { winner = i; break; }
                }
                drawSnailRace(positions);
                await new Promise(r => setTimeout(r, 30));
            }

            const selected = parseInt(document.querySelector('input[name="snail"]:checked').value);
            let profit = (selected === winner) ? Math.floor(bet * 2.8) : 0;
            await updatePoints(profit, 'snail', `SELECT NO.${selected+1}`, `WINNER NO.${winner+1}`);
            isRacing = false;
            document.getElementById('snail-start-btn').disabled = false;
            alert(`RACER NO.${winner+1} WIN!`);
        };

        // --- BACCARAT (VIP Version) ---
        window.playBaccarat = async (pick) => {
            const bet = parseInt(document.getElementById('bac-bet').value);
            if(bet > userData.balance || bet <= 0) return;

            document.getElementById('p-cards').innerHTML = '';
            document.getElementById('b-cards').innerHTML = '';
            document.querySelectorAll('.bac-btns button').forEach(b => b.disabled = true);
            await updatePoints(-bet, 'baccarat', pick.toUpperCase(), 'DEALING...');

            const p1 = Math.floor(Math.random() * 10);
            const p2 = Math.floor(Math.random() * 10);
            const b1 = Math.floor(Math.random() * 10);
            const b2 = Math.floor(Math.random() * 10);

            const addCard = (id, val) => {
                const div = document.createElement('div');
                div.className = 'card-obj';
                div.innerHTML = `<span>${val === 0 ? '10' : val}</span>`;
                document.getElementById(id).appendChild(div);
            };

            await new Promise(r => setTimeout(r, 600)); addCard('p-cards', p1);
            await new Promise(r => setTimeout(r, 600)); addCard('b-cards', b1);
            await new Promise(r => setTimeout(r, 600)); addCard('p-cards', p2);
            await new Promise(r => setTimeout(r, 600)); addCard('b-cards', b2);

            const pScore = (p1+p2)%10;
            const bScore = (b1+b2)%10;
            const result = pScore > bScore ? 'player' : (bScore > pScore ? 'banker' : 'tie');
            
            let profit = (pick === result) ? (result === 'tie' ? bet * 8 : bet * 2) : 0;
            await updatePoints(profit, 'baccarat', pick.toUpperCase(), `P:${pScore} B:${bScore}`);
            document.querySelectorAll('.bac-btns button').forEach(b => b.disabled = false);
            alert(`RESULT: ${result.toUpperCase()} (P:${pScore} B:${bScore})`);
        };

        window.allIn = (id) => { document.getElementById(id).value = userData.balance; };
    </script>

    <style>
        :root { --gold: #d4af37; --dark: #0a0a0a; --accent: #ff0000; }
        body { background: var(--dark); color: #fff; font-family: 'Roboto', sans-serif; margin: 0; overflow-x: hidden; }
        .view { display: none; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Login Design */
        .login-box { width: 350px; margin: 100px auto; background: #111; padding: 40px; border: 1px solid var(--gold); box-shadow: 0 0 20px rgba(212, 175, 55, 0.2); }
        h2 { font-family: 'Oswald', sans-serif; color: var(--gold); letter-spacing: 2px; text-transform: uppercase; }

        /* Lobby Design */
        .top-bar { background: #000; border-bottom: 2px solid var(--gold); padding: 15px 50px; display: flex; justify-content: space-between; align-items: center; }
        .balance-box { border: 1px solid var(--gold); padding: 5px 20px; font-weight: 900; color: var(--gold); font-size: 20px; }
        
        .game-grid { display: flex; justify-content: center; gap: 30px; margin-top: 50px; }
        .game-card { width: 300px; height: 400px; border: 1px solid #333; transition: 0.3s; cursor: pointer; position: relative; overflow: hidden; }
        .game-card:hover { border-color: var(--gold); transform: translateY(-10px); box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3); }
        .game-card.snail { background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1540747913346-19e32dc3e97e?auto=format&fit=crop&w=400&q=80'); background-size: cover; }
        .game-card.baccarat { background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1596838132731-3301c3fd4317?auto=format&fit=crop&w=400&q=80'); background-size: cover; }
        .game-card h3 { position: absolute; bottom: 20px; width: 100%; text-align: center; font-size: 28px; font-family: 'Oswald'; }

        /* Common Elements */
        input { background: #222; border: 1px solid #444; color: #fff; padding: 10px; margin: 5px; width: 80%; }
        button { background: var(--gold); border: none; color: #000; padding: 12px 25px; font-weight: 900; cursor: pointer; text-transform: uppercase; transition: 0.2s; }
        button:hover { background: #fff; }
        .all-in-btn { background: var(--accent); color: #fff; font-size: 11px; padding: 5px 10px; margin-left: -70px; }

        /* Table Design */
        table { width: 90%; margin: 30px auto; border-collapse: collapse; background: #111; border: 1px solid #333; }
        th { background: var(--gold); color: #000; padding: 10px; font-family: 'Oswald'; }
        td { padding: 12px; border-bottom: 1px solid #222; font-size: 13px; }
        .plus { color: #00ff00; font-weight: bold; }
        .minus { color: var(--accent); }

        /* Baccarat UI */
        .bac-table { display: flex; justify-content: center; gap: 50px; margin: 30px; }
        .bac-zone { background: #073b1c; border: 3px solid #0d5c2c; width: 200px; height: 150px; border-radius: 100px 100px 20px 20px; padding: 20px; position: relative; }
        .card-obj { width: 50px; height: 75px; background: #fff; color: #000; display: inline-block; margin: 5px; border-radius: 5px; font-weight: 900; line-height: 75px; font-size: 24px; box-shadow: 0 5px 10px rgba(0,0,0,0.5); animation: cardIn 0.5s ease-out; }
        @keyframes cardIn { from { transform: translateY(-100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <div id="login" class="view">
        <div class="login-box">
            <h2>MEMBER ACCESS</h2>
            <input type="email" id="email" placeholder="EMAIL ADDRESS">
            <input type="password" id="pw" placeholder="PASSWORD">
            <input type="text" id="nickname" placeholder="NICKNAME (NEW ACCOUNT)">
            <button onclick="handleAuth('login')" style="width: 100%; margin-top: 20px;">LOGIN</button>
            <button onclick="handleAuth('signup')" style="width: 100%; margin-top: 10px; background: #444; color: #fff;">REGISTER</button>
        </div>
    </div>

    <div id="lobby" class="view">
        <div class="top-bar">
            <div style="font-family: 'Oswald'; font-size: 24px; color: var(--gold);">GOLDEN ROYAL</div>
            <div class="balance-box">CREDIT: <span class="balance-txt">0</span></div>
            <button onclick="signOut(auth)" style="background:none; color:#666; font-size:12px;">LOGOUT</button>
        </div>
        
        <div class="game-grid">
            <div class="game-card snail" onclick="showView('snailGame')"><h3>SNAIL RACE</h3></div>
            <div class="game-card baccarat" onclick="showView('baccaratGame')"><h3>VIP BACCARAT</h3></div>
        </div>

        <table>
            <thead><tr><th>GAME</th><th>BET INFO</th><th>RESULT</th><th>PROFIT</th></tr></thead>
            <tbody id="historyBody"></tbody>
        </table>
        <button id="admin-btn" onclick="alert('CONSOLE UID ADMIN ONLY')" style="display:none; margin: 20px auto;">ADMIN PANEL</button>
    </div>

    <div id="snailGame" class="view">
        <div class="top-bar">
            <button onclick="showView('lobby')">BACK TO LOBBY</button>
            <div class="balance-box">CREDIT: <span class="balance-txt"></span></div>
        </div>
        <canvas id="snailCanvas" width="800" height="400"></canvas>
        <div style="margin-top: 20px;">
            <input type="radio" name="snail" value="0" checked> NO.1 |
            <input type="radio" name="snail" value="1"> NO.2 |
            <input type="radio" name="snail" value="2"> NO.3
            <br><br>
            <input type="number" id="snail-bet" value="10000" style="width: 200px;">
            <button class="all-in-btn" onclick="allIn('snail-bet')">ALL-IN</button>
            <button id="snail-start-btn" onclick="startSnailRace()">START RACE</button>
        </div>
    </div>

    <div id="baccaratGame" class="view">
        <div class="top-bar">
            <button onclick="showView('lobby')">BACK TO LOBBY</button>
            <div class="balance-box">CREDIT: <span class="balance-txt"></span></div>
        </div>
        
        <div class="bac-table">
            <div class="bac-zone">
                <div style="color: #fff; font-family: 'Oswald'; margin-bottom: 10px;">PLAYER</div>
                <div id="p-cards"></div>
            </div>
            <div class="bac-zone" style="background: #500a0a; border-color: #7a1212;">
                <div style="color: #fff; font-family: 'Oswald'; margin-bottom: 10px;">BANKER</div>
                <div id="b-cards"></div>
            </div>
        </div>

        <div class="bac-btns">
            <input type="number" id="bac-bet" value="10000" style="width: 200px;">
            <button class="all-in-btn" onclick="allIn('bac-bet')">ALL-IN</button><br><br>
            <button onclick="playBaccarat('player')" style="width:120px;">PLAYER</button>
            <button onclick="playBaccarat('tie')" style="background:#5b2c91; color:#fff; width:120px;">TIE</button>
            <button onclick="playBaccarat('banker')" style="background:#a91d1d; color:#fff; width:120px;">BANKER</button>
        </div>
    </div>

</body>
</html>
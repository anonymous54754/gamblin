<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOLDEN ROYAL : PRESTIGE</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Noto+Sans+KR:wght@300;700&display=swap" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        // ðŸ”¥ ë³¸ì¸ì˜ Firebase ì„¤ì •ê°’ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
        const firebaseConfig = {
  apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4",
  authDomain: "gambling-23339.firebaseapp.com",
  projectId: "gambling-23339",
  storageBucket: "gambling-23339.firebasestorage.app",
  messagingSenderId: "1031894079454",
  appId: "1:1031894079454:web:960ca0f1748493cdd9af4f",
  measurementId: "G-GT74F5GVR2"
};
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userDoc = null;
        let userData = { balance: 0, nickname: "", role: "user", history: [] };

        // --- í•µì‹¬: ì „ì—­ ê´€ë¦¬ìž ê¸°ëŠ¥ (ìˆ˜ì • ì™„ë£Œ) ---
        window.adminPanel = async () => {
            if (userData.role !== 'admin') {
                alert("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            const targetUid = prompt("í¬ì¸íŠ¸ë¥¼ ì¡°ì ˆí•  ì‚¬ìš©ìžì˜ UIDë¥¼ ìž…ë ¥í•˜ì„¸ìš”:");
            if (!targetUid) return;
            
            const amount = parseInt(prompt("ê°€ê°í•  í¬ì¸íŠ¸ ê¸ˆì•¡ì„ ìž…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 100000 ë˜ëŠ” -50000):"));
            if (isNaN(amount)) {
                alert("ìˆ«ìžë§Œ ìž…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                return;
            }

            try {
                const targetRef = doc(db, "users", targetUid);
                await updateDoc(targetRef, { balance: increment(amount) });
                alert("ì„±ê³µì ìœ¼ë¡œ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
                // ë‚´ ê³„ì • ìˆ˜ì • ì‹œ ë°ì´í„° ê°±ì‹ 
                if(targetUid === auth.currentUser.uid) refreshData();
            } catch (e) {
                alert("ì˜¤ë¥˜ ë°œìƒ: UIDê°€ ì •í™•í•œì§€ í™•ì¸í•˜ì„¸ìš”.\n" + e.message);
            }
        };

        async function refreshData() {
            const snap = await getDoc(userDoc);
            userData = snap.data();
            updateUI();
        }

        window.showView = async (vId) => {
            if (vId === 'baccaratGame') {
                if(!confirm("â™£ï¸ VIP BACCARAT â™£ï¸\n\nìµœëŒ€ ë°°íŒ… ì œí•œ ì—†ìŒ.\nìž…ìž¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            }
            document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
            document.getElementById(vId).style.display = 'block';
            if (userDoc) refreshData();
            if (vId === 'snailGame') startSnailDrawLoop();
        };

        function updateUI() {
            document.querySelectorAll('.balance-txt').forEach(el => el.innerText = (userData.balance || 0).toLocaleString());
            const historyBody = document.getElementById('historyBody');
            if (historyBody && userData.history) {
                historyBody.innerHTML = userData.history.slice().reverse().slice(0, 10).map(h => `
                    <tr>
                        <td style="color:#888; font-size:10px;">${h.game.toUpperCase()}</td>
                        <td style="font-weight:700;">${h.bet}</td>
                        <td class="${h.profit >= 0 ? 'plus' : 'minus'}">${h.profit >= 0 ? '+' : ''}${h.profit.toLocaleString()}</td>
                    </tr>
                `).join('');
            }
            document.getElementById('admin-btn').style.display = (userData.role === 'admin') ? 'block' : 'none';
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userDoc = doc(db, "users", user.uid);
                await refreshData();
                showView('lobby');
            } else {
                showView('login');
            }
        });

        window.handleAuth = async (mode) => {
            const email = document.getElementById('email').value;
            const pw = document.getElementById('pw').value;
            const nick = document.getElementById('nickname').value;
            try {
                if (mode === 'signup') {
                    const res = await createUserWithEmailAndPassword(auth, email, pw);
                    await setDoc(doc(db, "users", res.user.uid), { nickname: nick || "VIP", balance: 100000, role: "user", history: [] });
                } else {
                    await signInWithEmailAndPassword(auth, email, pw);
                }
            } catch (e) { alert("ERROR: " + e.message); }
        };

        async function commitGame(profit, game, bet, res) {
            await updateDoc(userDoc, {
                balance: increment(profit),
                history: arrayUnion({ game, bet, result: res, profit, time: new Date().toISOString() })
            });
            refreshData();
        }

        // --- SNAIL RACE: HIGH-END GRAPHICS ---
        let snailAnim = null;
        let snailPositions = [80, 80, 80];
        function startSnailDrawLoop() {
            const canvas = document.getElementById('snailCanvas');
            const ctx = canvas.getContext('2d');
            function render() {
                ctx.clearRect(0,0,800,400);
                // íŠ¸ëž™ ë°°ê²½
                ctx.fillStyle = "#111";
                ctx.fillRect(0,0,800,400);
                for(let i=0; i<4; i++) {
                    ctx.strokeStyle = "#222";
                    ctx.beginPath(); ctx.moveTo(0, i*100); ctx.lineTo(800, i*100); ctx.stroke();
                }
                // ê²°ìŠ¹ì„  ë„¤ì˜¨ ì´íŽ™íŠ¸
                ctx.shadowBlur = 20; ctx.shadowColor = "#ffcd3c";
                ctx.fillStyle = "#ffcd3c";
                ctx.fillRect(720, 0, 5, 400);
                ctx.shadowBlur = 0;

                const colors = ["#ff3e3e", "#3eafff", "#3eff8b"];
                const names = ["MARS", "NEPTUNE", "VENUS"];
                for(let i=0; i<3; i++) {
                    const y = 50 + i*100;
                    // ë ˆì´ì„œ ë³¸ì²´ (ê·¸ë¼ë°ì´ì…˜)
                    let grad = ctx.createLinearGradient(snailPositions[i]-50, 0, snailPositions[i]+20, 0);
                    grad.addColorStop(0, "transparent");
                    grad.addColorStop(1, colors[i]);
                    ctx.fillStyle = grad;
                    ctx.fillRect(snailPositions[i]-60, y-15, 60, 30);
                    // ë ˆì´ì„œ í—¤ë“œ
                    ctx.fillStyle = "#fff";
                    ctx.font = "bold 14px Oswald";
                    ctx.fillText(names[i], snailPositions[i]-50, y+5);
                }
                snailAnim = requestAnimationFrame(render);
            }
            render();
        }

        window.startSnailRace = async () => {
            const bet = parseInt(document.getElementById('snail-bet').value);
            if(bet > userData.balance || bet <= 0) return;
            const selected = parseInt(document.querySelector('input[name="snail"]:checked').value);
            
            document.getElementById('snail-start-btn').disabled = true;
            await commitGame(-bet, 'snail', 'RACING', 'PENDING');

            let winner = null;
            const raceInterval = setInterval(() => {
                for(let i=0; i<3; i++) {
                    snailPositions[i] += Math.random() * 7 + 2;
                    if(snailPositions[i] >= 720) {
                        winner = i;
                        clearInterval(raceInterval);
                        cancelAnimationFrame(snailAnim);
                        finalizeSnail(winner, selected, bet);
                        break;
                    }
                }
            }, 30);
        };

        async function finalizeSnail(winner, selected, bet) {
            let profit = (winner === selected) ? Math.floor(bet * 2.8) : 0;
            alert(`WINNER: NO.${winner+1}`);
            await commitGame(profit, 'snail', `NO.${selected+1}`, `WIN NO.${winner+1}`);
            snailPositions = [80, 80, 80];
            document.getElementById('snail-start-btn').disabled = false;
            startSnailDrawLoop();
        }

        // --- BACCARAT: LUXURY CARD ANIMATION ---
        window.playBaccarat = async (pick) => {
            const bet = parseInt(document.getElementById('bac-bet').value);
            if(bet > userData.balance || bet <= 0) return;

            document.getElementById('p-cards').innerHTML = '';
            document.getElementById('b-cards').innerHTML = '';
            document.querySelectorAll('.bac-btns button').forEach(b => b.disabled = true);
            await commitGame(-bet, 'baccarat', pick.toUpperCase(), 'DEALING');

            const p1 = Math.floor(Math.random() * 9) + 1;
            const p2 = Math.floor(Math.random() * 9) + 1;
            const b1 = Math.floor(Math.random() * 9) + 1;
            const b2 = Math.floor(Math.random() * 9) + 1;

            const deal = async (id, val) => {
                const card = document.createElement('div');
                card.className = 'card-obj';
                card.innerHTML = `<span>${val}</span>`;
                document.getElementById(id).appendChild(card);
                await new Promise(r => setTimeout(r, 600));
            };

            await deal('p-cards', p1); await deal('b-cards', b1);
            await deal('p-cards', p2); await deal('b-cards', b2);

            const pScore = (p1+p2)%10; const bScore = (b1+b2)%10;
            const result = pScore > bScore ? 'player' : (bScore > pScore ? 'banker' : 'tie');
            
            let profit = (pick === result) ? (result === 'tie' ? bet * 8 : bet * 2) : 0;
            await commitGame(profit, 'baccarat', pick.toUpperCase(), `P:${pScore} B:${bScore}`);
            document.querySelectorAll('.bac-btns button').forEach(b => b.disabled = false);
            alert(`[ ${result.toUpperCase()} WIN ]\nPLAYER: ${pScore} / BANKER: ${bScore}`);
        };

        window.allIn = (id) => { document.getElementById(id).value = userData.balance; };

    </script>
    <style>
        :root { --gold: #c3a469; --dark: #070707; --surface: #121212; --win: #00ff88; --loss: #ff3c3c; }
        body { background: var(--dark); color: #fff; font-family: 'Noto Sans KR', sans-serif; margin: 0; }
        
        /* Premium Header */
        .header { background: #000; border-bottom: 1px solid #222; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; z-index: 100; }
        .logo { font-family: 'Oswald'; font-size: 26px; letter-spacing: 4px; color: var(--gold); }
        .credit-display { font-family: 'Oswald'; color: var(--gold); font-size: 22px; background: rgba(195,164,105,0.1); padding: 5px 20px; border-radius: 50px; border: 1px solid var(--gold); }

        /* Elegant View Container */
        .view { display: none; padding: 40px; animation: slideUp 0.6s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Lobby Cards */
        .lobby-grid { display: flex; justify-content: center; gap: 40px; margin-top: 50px; }
        .game-selector { width: 350px; height: 500px; border: 1px solid #222; background-size: cover; background-position: center; position: relative; cursor: pointer; transition: 0.4s; }
        .game-selector:hover { transform: scale(1.03); border-color: var(--gold); box-shadow: 0 0 50px rgba(195,164,105,0.2); }
        .game-selector .label { position: absolute; bottom: 0; width: 100%; background: linear-gradient(transparent, #000); padding: 40px 0; text-align: center; font-family: 'Oswald'; font-size: 32px; }

        /* Baccarat UI */
        .bacc-container { display: flex; justify-content: center; gap: 60px; margin: 50px 0; }
        .bet-zone { width: 220px; height: 180px; background: radial-gradient(circle, #1a4d2e, #0a2d1a); border: 2px solid #2d6a4f; border-radius: 110px 110px 10px 10px; padding: 30px; }
        .card-obj { width: 60px; height: 90px; background: #fff; color: #000; display: inline-block; margin: 5px; border-radius: 6px; font-weight: 900; line-height: 90px; font-size: 28px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); transform-origin: center; animation: deal 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes deal { from { transform: translateY(-200px) rotate(45deg); opacity: 0; } to { transform: translateY(0) rotate(0); opacity: 1; } }

        /* Admin/Global Button */
        button { background: var(--gold); color: #000; border: none; padding: 12px 30px; font-family: 'Oswald'; font-weight: 700; cursor: pointer; text-transform: uppercase; border-radius: 3px; }
        button:hover { background: #fff; }
        input { background: #111; border: 1px solid #333; color: #fff; padding: 12px; font-size: 16px; margin: 10px 0; }
        .all-in-mini { background: #ff3c3c; color: #fff; font-size: 10px; padding: 4px 8px; vertical-align: middle; }

        /* History Table */
        table { width: 100%; max-width: 900px; margin: 40px auto; border-collapse: collapse; }
        th { border-bottom: 2px solid var(--gold); padding: 15px; font-family: 'Oswald'; color: var(--gold); text-align: left; }
        td { padding: 15px; border-bottom: 1px solid #1a1a1a; }
        .plus { color: var(--win); } .minus { color: var(--loss); }

        /* Auth Box */
        .auth-card { width: 400px; margin: 100px auto; padding: 50px; background: var(--surface); border: 1px solid #222; border-top: 4px solid var(--gold); }
    </style>
</head>
<body>

    <div id="login" class="view">
        <div class="auth-card">
            <div class="logo" style="margin-bottom:30px; text-align:center;">PRESTIGE LOGIN</div>
            <input type="email" id="email" placeholder="E-MAIL" style="width:100%;">
            <input type="password" id="pw" placeholder="PASSWORD" style="width:100%;">
            <input type="text" id="nickname" placeholder="NICKNAME (FOR SIGNUP)" style="width:100%;">
            <button onclick="handleAuth('login')" style="width:100%; margin-top:20px;">ENTER</button>
            <button onclick="handleAuth('signup')" style="width:100%; margin-top:10px; background:#222; color:#888;">REGISTER</button>
        </div>
    </div>

    <div id="lobby" class="view">
        <div class="header">
            <div class="logo">GOLDEN ROYAL</div>
            <div class="credit-display">CREDIT: <span class="balance-txt">0</span></div>
            <button id="admin-btn" onclick="adminPanel()" style="display:none; background:#ffcd3c;">ADMIN</button>
        </div>
        
        <div class="lobby-grid">
            <div class="game-selector" style="background-image: url('https://images.unsplash.com/photo-1511193311914-0346f16efe90?auto=format&fit=crop&w=400&q=80');" onclick="showView('snailGame')">
                <div class="label">NEON SNAIL RACE</div>
            </div>
            <div class="game-selector" style="background-image: url('https://images.unsplash.com/photo-1518133835878-5a93cc3f89e5?auto=format&fit=crop&w=400&q=80');" onclick="showView('baccaratGame')">
                <div class="label">VIP BACCARAT</div>
            </div>
        </div>

        <table>
            <thead><tr><th>GAME</th><th>BET</th><th>PROFIT</th></tr></thead>
            <tbody id="historyBody"></tbody>
        </table>
    </div>

    <div id="snailGame" class="view">
        <div class="header">
            <button onclick="showView('lobby')">EXIT</button>
            <div class="credit-display"><span class="balance-txt"></span></div>
        </div>
        <canvas id="snailCanvas" width="800" height="400"></canvas>
        <div style="text-align:center; margin-top:20px;">
            <input type="radio" name="snail" value="0" checked> NO.1 MARS | 
            <input type="radio" name="snail" value="1"> NO.2 NEPTUNE | 
            <input type="radio" name="snail" value="2"> NO.3 VENUS
            <br>
            <input type="number" id="snail-bet" value="10000" style="width:200px;">
            <button class="all-in-mini" onclick="allIn('snail-bet')">MAX</button>
            <button id="snail-start-btn" onclick="startSnailRace()">PLACE BET & START</button>
        </div>
    </div>

    <div id="baccaratGame" class="view">
        <div class="header">
            <button onclick="showView('lobby')">EXIT</button>
            <div class="credit-display"><span class="balance-txt"></span></div>
        </div>
        <div class="bacc-container">
            <div class="bet-zone">
                <div style="font-family:'Oswald'; letter-spacing:2px; margin-bottom:20px;">PLAYER</div>
                <div id="p-cards"></div>
            </div>
            <div class="bet-zone" style="background: radial-gradient(circle, #4d1a1a, #2d0a0a); border-color: #6a2d2d;">
                <div style="font-family:'Oswald'; letter-spacing:2px; margin-bottom:20px;">BANKER</div>
                <div id="b-cards"></div>
            </div>
        </div>
        <div class="bac-btns" style="text-align:center;">
            <input type="number" id="bac-bet" value="10000" style="width:200px;">
            <button class="all-in-mini" onclick="allIn('bac-bet')">MAX</button><br><br>
            <button onclick="playBaccarat('player')" style="width:150px;">PLAYER (x2)</button>
            <button onclick="playBaccarat('tie')" style="background:#5b2c91; width:150px; color:#fff;">TIE (x8)</button>
            <button onclick="playBaccarat('banker')" style="background:#8c1c1c; width:150px; color:#fff;">BANKER (x2)</button>
        </div>
    </div>

</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEON ROYAL CASINO</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #050505;
            --card-bg: #111111;
            --text-white: #ffffff;
            --neon-pink: #ff00ff;
            --neon-blue: #00ffff;
            --neon-gold: #eebb4d;
            --accent-red: #ff3131;
            --dark-green: #004d40;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-white);
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0; padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- ÌòÑÎûÄÌïú ÎÑ§Ïò® Ïï†ÎãàÎ©îÏù¥ÏÖò --- */
        @keyframes neon-glow {
            0% { box-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
            50% { box-shadow: 0 0 20px var(--neon-pink), 0 0 40px var(--neon-pink); }
            100% { box-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
        }

        @keyframes border-flicker {
            0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; }
        }

        /* ÏÉÅÎã® Ìó§Îçî */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(0,0,0,0.95);
            border-bottom: 3px solid var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
            position: sticky; top: 0; z-index: 1000;
        }
        .logo {
            font-size: 28px; font-weight: 900; font-style: italic;
            text-shadow: 0 0 15px var(--neon-blue);
            letter-spacing: -1px;
        }
        .logo span { color: var(--neon-pink); text-shadow: 0 0 15px var(--neon-pink); }

        .balance-badge {
            background: #000;
            color: var(--neon-gold);
            padding: 8px 18px;
            border: 2px solid var(--neon-gold);
            border-radius: 50px;
            font-weight: 900;
            font-size: 18px;
            box-shadow: inset 0 0 10px var(--neon-gold), 0 0 10px var(--neon-gold);
        }

        /* Î©îÏù∏ Î∞∞ÎÑà */
        .hero-banner {
            width: 100%; height: 250px;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1596838132731-3301c3fd4317?auto=format&fit=crop&w=1200&q=80') center/cover;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-bottom: 2px solid #222;
        }
        .hero-banner h1 { 
            font-size: 48px; color: #fff; text-shadow: 0 0 30px var(--neon-pink);
            margin: 0; font-weight: 900; text-transform: uppercase;
        }
        .hero-banner p { color: var(--neon-blue); font-weight: bold; font-size: 18px; }

        /* Í≤åÏûÑ ÏÑ†ÌÉù Í∑∏Î¶¨Îìú */
        .game-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 25px; padding: 30px;
        }
        .game-card {
            background: var(--card-bg);
            border-radius: 15px; overflow: hidden;
            border: 2px solid #333;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; cursor: pointer;
        }
        .game-card:hover {
            border-color: var(--neon-blue);
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--neon-blue);
        }
        .game-thumb {
            width: 100%; height: 140px;
            background-size: cover; background-position: center;
            border-bottom: 1px solid #222;
        }
        .game-info { padding: 15px; text-align: center; }
        .game-name { font-weight: 900; font-size: 18px; color: #fff; margin-bottom: 5px; }
        .game-provider { font-size: 12px; color: var(--neon-blue); font-weight: bold; text-transform: uppercase; }

        /* Ïù∏Í≤åÏûÑ Ïª®ÌÖåÏù¥ÎÑà */
        .view { display: none; padding-bottom: 100px; }
        .active-view { display: block; animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .ingame-container {
            max-width: 900px; margin: 30px auto;
            background: #0a0a0a; padding: 30px;
            border: 2px solid var(--neon-pink);
            box-shadow: 0 0 40px rgba(255, 0, 255, 0.15);
            border-radius: 20px;
        }

        /* Î∞îÏπ¥Îùº Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        #bac-table {
            background: radial-gradient(circle, #00695c 0%, #002e2c 100%);
            border: 12px solid #4e342e; border-radius: 150px;
            padding: 50px 20px; margin-bottom: 30px;
            box-shadow: inset 0 0 80px #000, 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
        }

        /* Î≤ÑÌäº & Ïª®Ìä∏Î°§ */
        button { cursor: pointer; border: none; font-family: 'Noto Sans KR'; }
        .btn-neon-main {
            background: transparent; color: #fff;
            border: 2px solid var(--neon-blue);
            padding: 15px; font-weight: 900; font-size: 20px;
            border-radius: 10px; width: 100%;
            text-shadow: 0 0 10px var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue);
            transition: 0.2s;
        }
        .btn-neon-main:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 30px var(--neon-blue); }
        .btn-neon-main:disabled { 
            background: #222 !important; border-color: #444 !important; 
            color: #666 !important; box-shadow: none !important; text-shadow: none;
        }

        input[type="number"] {
            background: #111; border: 2px solid var(--neon-gold);
            color: var(--neon-gold); padding: 15px; width: 70%;
            font-size: 22px; font-weight: 900; text-align: center;
            border-radius: 8px; margin-bottom: 20px;
            box-shadow: inset 0 0 10px rgba(238, 187, 77, 0.2);
        }

        canvas { 
            width: 100%; border: 4px solid var(--neon-gold); 
            border-radius: 15px; background: #222;
        }

        .bet-selector {
            display: flex; justify-content: center; gap: 15px; margin-bottom: 20px;
        }
        .bet-selector label {
            background: #222; padding: 10px 20px; border-radius: 5px; cursor: pointer; border: 1px solid #444;
        }
        .bet-selector input:checked + span { color: var(--neon-pink); font-weight: 900; }

    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        // üî• ÏÇ¨Ïö©ÏûêÏùò Firebase ÏÑ§Ï†ïÏùÑ ÏôÑÎ≤ΩÌïòÍ≤å Ïú†ÏßÄÌï©ÎãàÎã§!
        const firebaseConfig = {
            apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4",
            authDomain: "gambling-23339.firebaseapp.com",
            projectId: "gambling-23339",
            storageBucket: "gambling-23339.firebasestorage.app",
            messagingSenderId: "1031894079454",
            appId: "1:1031894079454:web:960ca0f1748493cdd9af4f",
            measurementId: "G-GT74F5GVR2"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userData = { balance: 0, history: [] };

        // Î¶¨ÏÜåÏä§ ÌîÑÎ¶¨Î°úÎìú
        const snailImg = new Image(); snailImg.src = "https://cdn-icons-png.flaticon.com/512/3063/3063822.png";
        const trackBg = new Image(); trackBg.src = "https://img.freepik.com/free-photo/brown-soil-texture-background_1101-1668.jpg";

        window.showView = (id) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
            document.getElementById(id).classList.add('active-view');
            if(id === 'snailGame') startSnailLoop();
        };

        const refreshData = async () => {
            if(!auth.currentUser) return;
            const snap = await getDoc(doc(db, "users", auth.currentUser.uid));
            if(snap.exists()) {
                userData = snap.data();
                document.querySelectorAll('.balance-val').forEach(el => el.innerText = userData.balance.toLocaleString());
            }
        };

        // --- [SNAIL RACE] Í≤åÏûÑ Î°úÏßÅ ---
        let snails = [10, 10, 10];
        let snailRaf;
        function startSnailLoop() {
            const cvs = document.getElementById('snailCanvas');
            const ctx = cvs.getContext('2d');
            function draw() {
                ctx.drawImage(trackBg, 0, 0, cvs.width, cvs.height);
                // Ìä∏Îûô Íµ¨Î∂ÑÏÑ†
                ctx.strokeStyle = "rgba(255,255,255,0.2)";
                ctx.lineWidth = 2;
                for(let i=1; i<3; i++) {
                    ctx.beginPath(); ctx.moveTo(0, i*100); ctx.lineTo(cvs.width, i*100); ctx.stroke();
                }
                // Í≤∞ÏäπÏÑ†
                ctx.fillStyle = "gold"; ctx.fillRect(cvs.width-50, 0, 10, cvs.height);

                for(let i=0; i<3; i++) {
                    ctx.drawImage(snailImg, snails[i], i*100+10, 80, 80);
                    ctx.fillStyle = "#fff"; ctx.font = "900 20px Noto Sans KR";
                    ctx.fillText(`${i+1}Î≤à Îã¨ÌåΩÏù¥`, snails[i], i*100+40);
                }
                snailRaf = requestAnimationFrame(draw);
            }
            draw();
        }

        window.runSnail = async () => {
            const betInput = document.getElementById('snail-bet');
            const bet = parseInt(betInput.value);
            if(isNaN(bet) || bet > userData.balance || bet <= 0) return alert("Î∞∞ÌåÖ Í∏àÏï°Ïù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÍ±∞ÎÇò ÏûîÏï°Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§.");

            // üî• Î∞∞ÌåÖ Ïû†Í∏à: ÏãúÏûëÍ≥º ÎèôÏãúÏóê ÏûÖÎ†•Ï∞ΩÍ≥º ÏÑ†ÌÉù Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            const startBtn = document.getElementById('btn-snail-start');
            const radioButtons = document.getElementsByName('spick');
            startBtn.disabled = true;
            betInput.disabled = true;
            radioButtons.forEach(rb => rb.disabled = true);

            await updateDoc(doc(db, "users", auth.currentUser.uid), { balance: increment(-bet) });
            refreshData();

            const pick = parseInt(document.querySelector('input[name="spick"]:checked').value);
            
            let raceInterval = setInterval(async () => {
                let winner = -1;
                for(let i=0; i<3; i++) {
                    snails[i] += Math.random() * 7;
                    if(snails[i] >= 720) winner = i;
                }

                if(winner !== -1) {
                    clearInterval(raceInterval);
                    const isWin = (winner === pick);
                    const profit = isWin ? Math.floor(bet * 2.9) : 0;
                    
                    setTimeout(async () => {
                        alert(isWin ? `üéâ Ï∂ïÌïòÌï©ÎãàÎã§! ${winner+1}Î≤à Îã¨ÌåΩÏù¥ Ïö∞Ïäπ! Î∞∞ÎãπÍ∏àÏùÑ ÏàòÎ†πÌïòÏÑ∏Ïöî.` : `üíÄ ${winner+1}Î≤à Îã¨ÌåΩÏù¥Í∞Ä Î®ºÏ†Ä ÎèÑÏ∞©ÌñàÏäµÎãàÎã§. Îã§Ïùå Í∏∞ÌöåÏóê...`);
                        
                        await updateDoc(doc(db, "users", auth.currentUser.uid), {
                            balance: increment(profit),
                            history: arrayUnion({ game: 'snail', bet, profit: isWin ? profit-bet : -bet, time: new Date() })
                        });

                        // Ï¥àÍ∏∞Ìôî Î∞è Ïû†Í∏à Ìï¥Ï†ú
                        snails = [10, 10, 10];
                        startBtn.disabled = false;
                        betInput.disabled = false;
                        radioButtons.forEach(rb => rb.disabled = false);
                        refreshData();
                    }, 500);
                }
            }, 30);
        };

        // --- [BACCARAT] Í≤åÏûÑ Î°úÏßÅ ---
        window.playBac = async (choice) => {
            const bet = parseInt(document.getElementById('bac-bet').value);
            if(isNaN(bet) || bet > userData.balance || bet <= 0) return alert("ÏûîÏï° Î∂ÄÏ°±");

            await updateDoc(doc(db, "users", auth.currentUser.uid), { balance: increment(-bet) });
            refreshData();

            const pDiv = document.getElementById('p-cards');
            const bDiv = document.getElementById('b-cards');
            pDiv.innerHTML = ''; bDiv.innerHTML = '';

            const drawCard = () => {
                const n = Math.floor(Math.random()*13)+1;
                const s = ['H','D','C','S'][Math.floor(Math.random()*4)];
                const code = (n === 1 ? 'A' : (n === 11 ? 'J' : (n === 12 ? 'Q' : (n === 13 ? 'K' : n))));
                return { n, s, val: n >= 10 ? 0 : n, img: `https://deckofcardsapi.com/static/img/${code}${s}.png` };
            };

            const p1=drawCard(), p2=drawCard(), b1=drawCard(), b2=drawCard();
            
            const addCardImg = (div, card) => {
                const img = document.createElement('img');
                img.src = card.img; img.style.width = '90px'; img.style.margin = '5px';
                img.style.boxShadow = "0 5px 15px rgba(0,0,0,0.5)";
                div.appendChild(img);
            };

            // ÏàúÏ∞®Ï†Å Ïπ¥Îìú Ïò§Ìîà Ïó∞Ï∂ú
            setTimeout(() => addCardImg(pDiv, p1), 200);
            setTimeout(() => addCardImg(bDiv, b1), 400);
            setTimeout(() => addCardImg(pDiv, p2), 600);
            setTimeout(() => {
                addCardImg(bDiv, b2);
                const pScore = (p1.val + p2.val) % 10;
                const bScore = (b1.val + b2.val) % 10;
                let res = 'tie';
                if(pScore > bScore) res = 'player';
                else if(bScore > pScore) res = 'banker';

                const isWin = (choice === res);
                const mult = (res === 'tie') ? 9 : 2;
                const profit = isWin ? bet * mult : 0;

                setTimeout(async () => {
                    alert(`[Í≤∞Í≥º] PLAYER(${pScore}) vs BANKER(${bScore})\n${res.toUpperCase()} ÏäπÎ¶¨!`);
                    if(profit > 0) await updateDoc(doc(db, "users", auth.currentUser.uid), { balance: increment(profit) });
                    refreshData();
                }, 500);
            }, 800);
        };

        // Ïù∏Ï¶ù Í¥ÄÎ¶¨
        window.handleAuth = async (isLogin) => {
            const email = document.getElementById('email').value;
            const pw = document.getElementById('pw').value;
            try {
                if(isLogin) await signInWithEmailAndPassword(auth, email, pw);
                else {
                    const res = await createUserWithEmailAndPassword(auth, email, pw);
                    await setDoc(doc(db, "users", res.user.uid), { nickname: 'VVIP', balance: 1000000, history: [], role: 'user' });
                }
            } catch(e) { alert("Ïù∏Ï¶ù Ïò§Î•ò: " + e.message); }
        };

        onAuthStateChanged(auth, (user) => {
            if(user) { refreshData(); showView('lobby'); }
            else showView('login');
        });

        window.allIn = (id) => { document.getElementById(id).value = userData.balance; };

    </script>
</head>
<body>

    <div id="login" class="view active-view">
        <div style="text-align:center; padding-top:100px;">
            <h1 class="logo">NEON <span>ROYAL</span> CASINO</h1>
            <p style="color:#888;">ÏµúÍ≥†Ïùò Í∑∏ÎûòÌîΩÍ≥º Î∞∞ÎãπÎ•†ÏùÑ Í≤ΩÌóòÌïòÏÑ∏Ïöî</p>
            <div style="max-width:350px; margin: 40px auto; background:#111; padding:30px; border-radius:20px; border:1px solid #333;">
                <input type="email" id="email" placeholder="ÏïÑÏù¥Îîî(Ïù¥Î©îÏùº)" style="width:100%; margin-bottom:15px; box-sizing:border-box;">
                <input type="password" id="pw" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏" style="width:100%; margin-bottom:25px; box-sizing:border-box;">
                <button class="btn-neon-main" onclick="handleAuth(true)">Î°úÍ∑∏Ïù∏</button>
                <button onclick="handleAuth(false)" style="background:none; color:#555; margin-top:20px;">Ïã†Í∑ú ÌöåÏõêÍ∞ÄÏûÖ</button>
            </div>
        </div>
    </div>

    <div id="lobby" class="view">
        <div class="app-header">
            <div class="logo">NEON <span>ROYAL</span></div>
            <div class="balance-badge">‚Ç© <span class="balance-val">0</span></div>
        </div>
        <div class="hero-banner">
            <h1>JACKPOT EVENT</h1>
            <p>Ïã†Í∑ú Í∞ÄÏûÖ Ïãú 1,000,000 Ìè¨Ïù∏Ìä∏ Ï¶âÏãú ÏßÄÍ∏â</p>
        </div>
        
        <div class="game-grid">
            <div class="game-card" onclick="showView('snailGame')">
                <div class="game-thumb" style="background-image: url('https://img.freepik.com/free-photo/vibrant-neon-snail-racing-track_23-2151027457.jpg');"></div>
                <div class="game-info">
                    <div class="game-name">ÎÑ§Ïò® Îã¨ÌåΩÏù¥ Î†àÏù¥Ïã±</div>
                    <div class="game-provider">LIVE SPORTS</div>
                </div>
            </div>
            <div class="game-card" onclick="showView('baccaratGame')">
                <div class="game-thumb" style="background-image: url('https://images.unsplash.com/photo-1511512578047-dfb367046420?auto=format&fit=crop&w=600&q=80');"></div>
                <div class="game-info">
                    <div class="game-name">VIP Î∞îÏπ¥Îùº</div>
                    <div class="game-provider">CASINO ROYAL</div>
                </div>
            </div>
            <div class="game-card" style="opacity:0.5; filter:grayscale(1);">
                <div class="game-thumb" style="background-image: url('https://img.freepik.com/free-photo/slot-machine-lucky-jackpot_23-2148883154.jpg');"></div>
                <div class="game-info"><div class="game-name">Ïä¨Î°Ø Î®∏Ïã†</div><div class="game-provider">Ï§ÄÎπÑ Ï§ë</div></div>
            </div>
            <div class="game-card" style="opacity:0.5; filter:grayscale(1);">
                <div class="game-thumb" style="background-image: url('https://img.freepik.com/free-photo/roulette-table-casino_23-2148883162.jpg');"></div>
                <div class="game-info"><div class="game-name">Î£∞Î†õ</div><div class="game-provider">Ï§ÄÎπÑ Ï§ë</div></div>
            </div>
        </div>
    </div>

    <div id="snailGame" class="view">
        <div class="app-header">
            <button onclick="showView('lobby')" style="background:none; color:white; font-size:24px;"><i class="fa-solid fa-arrow-left"></i></button>
            <div class="balance-badge">‚Ç© <span class="balance-val">0</span></div>
        </div>
        <div class="ingame-container">
            <h2 style="text-align:center; color:var(--neon-gold); text-shadow: 0 0 10px gold;">üèÅ SPEED SNAIL RACE</h2>
            <canvas id="snailCanvas" width="800" height="300"></canvas>
            
            <div style="text-align:center; margin-top:30px;">
                <div class="bet-selector">
                    <label><input type="radio" name="spick" value="0" checked> <span>1Î≤à</span></label>
                    <label><input type="radio" name="spick" value="1"> <span>2Î≤à</span></label>
                    <label><input type="radio" name="spick" value="2"> <span>3Î≤à</span></label>
                </div>
                <input type="number" id="snail-bet" placeholder="Î∞∞ÌåÖÏï° ÏûÖÎ†•">
                <button class="btn-neon-main" id="btn-snail-start" onclick="runSnail()">Í≤ΩÍ∏∞ ÏãúÏûë</button>
            </div>
        </div>
    </div>

    <div id="baccaratGame" class="view">
        <div class="app-header">
            <button onclick="showView('lobby')" style="background:none; color:white; font-size:24px;"><i class="fa-solid fa-arrow-left"></i></button>
            <div class="balance-badge">‚Ç© <span class="balance-val">0</span></div>
        </div>
        <div class="ingame-container">
            <div id="bac-table">
                <div style="display:flex; justify-content:space-around; align-items:flex-start;">
                    <div style="text-align:center;">
                        <h3 style="color:var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue);">PLAYER</h3>
                        <div id="p-cards" style="min-height:120px; display:flex;"></div>
                    </div>
                    <div style="text-align:center;">
                        <h3 style="color:var(--accent-red); text-shadow: 0 0 10px var(--accent-red);">BANKER</h3>
                        <div id="b-cards" style="min-height:120px; display:flex;"></div>
                    </div>
                </div>
            </div>
            
            <div style="text-align:center;">
                <input type="number" id="bac-bet" placeholder="Î∞∞ÌåÖÏï° ÏûÖÎ†•"><br>
                <div style="display:flex; gap:15px; max-width:600px; margin: 0 auto;">
                    <button class="btn-neon-main" style="border-color:var(--neon-blue);" onclick="playBac('player')">PLAYER (x2)</button>
                    <button class="btn-neon-main" style="border-color:var(--neon-gold); color:var(--neon-gold);" onclick="playBac('tie')">TIE (x9)</button>
                    <button class="btn-neon-main" style="border-color:var(--accent-red);" onclick="playBac('banker')">BANKER (x2)</button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
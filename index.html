<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S SUPER 9 BET | OFFICIAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --point-gold: #eebb4d; --bg-dark: #0a0a0a; --panel-bg: #1a1a1a; --card-w: 80px; --card-h: 115px; }
        body { background-color: var(--bg-dark); color: #eee; font-family: 'Noto Sans KR', sans-serif; margin: 0; overflow-x: hidden; }

        /* ê²°ê³¼ íŒì—… */
        #resultPopup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; 
                       background: rgba(0,0,0,0.95); border: 3px solid var(--point-gold); padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 0 50px gold; min-width: 320px; }
        #resultPopup h1 { font-size: 40px; margin-bottom: 10px; }
        .win-title { color: gold; text-shadow: 0 0 10px yellow; }
        .lose-title { color: #ff5252; }

        /* ìƒë‹¨ ë„¤ë¹„ */
        .top-nav { background: linear-gradient(180deg, #2e7d32, #1b5e20); height: 65px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; position: sticky; top:0; z-index: 1000; }
        .logo { font-size: 24px; font-weight: 900; color: #fff; cursor: pointer; font-style: italic; }
        .asset-box { background: rgba(0,0,0,0.6); padding: 8px 20px; border-radius: 20px; border: 1px solid gold; color: gold; font-weight: 900; font-size: 18px; }

        /* ë ˆì´ì•„ì›ƒ */
        .main-wrapper { display: flex; min-height: calc(100vh - 65px); }
        .sidebar { width: 230px; background: #111; border-right: 1px solid #222; }
        .menu-item { padding: 20px; cursor: pointer; color: #888; border-left: 4px solid transparent; transition: 0.3s; }
        .menu-active { background: #1a1a1a; border-left: 4px solid gold; color: gold; }
        .content { flex: 1; padding: 30px; background: #141414; }

        /* ë¡œë¹„ ì „ê´‘íŒ */
        .ad-banner { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .ad-item { height: 80px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 900; border: 2px solid #f00; animation: blink 0.5s infinite alternate; }
        @keyframes blink { from { opacity: 1; } to { opacity: 0.7; } }

        /* ê²Œì„ ê³µí†µ */
        .game-panel { background: var(--panel-bg); border-radius: 20px; padding: 30px; text-align: center; border: 1px solid #333; margin-bottom: 20px; }
        .bet-input { background: #000; border: 1px solid #444; color: gold; padding: 12px; font-size: 20px; border-radius: 5px; text-align: center; width: 200px; }
        .btn-play { background: gold; color: #000; border: none; padding: 15px 40px; font-weight: 900; border-radius: 5px; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 0 #b8860b; }

        /* ë°”ì¹´ë¼ í…Œì´ë¸” */
        .bac-table { background: radial-gradient(circle, #2e7d32, #1b5e20); border: 8px solid #4e342e; border-radius: 100px; padding: 40px; display: flex; justify-content: center; gap: 40px; margin: 20px 0; }
        .card-slot { width: var(--card-w); height: var(--card-h); perspective: 1000px; display: inline-block; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.8s; transform-style: preserve-3d; }
        .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; background: url('https://deckofcardsapi.com/static/img/back.png') center/cover; border-radius: 5px; }
        .card-front { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; transform: rotateY(180deg); background-size: cover; border-radius: 5px; }
        .flipped { transform: rotateY(180deg); }

        /* ìŠ¬ë¡¯ ë¨¸ì‹  */
        .slot-machine { background: #222; padding: 20px; border-radius: 15px; border: 5px solid #444; display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        .reel { width: 90px; height: 120px; background: #fff; border-radius: 5px; overflow: hidden; position: relative; border: 2px solid #000; }
        .reel-img-container { position: absolute; width: 100%; top: 0; }

        /* ê²Œì‹œíŒ í…Œì´ë¸” */
        .cs-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .cs-table th { background: #222; color: gold; padding: 12px; }
        .cs-table td { padding: 12px; border-bottom: 1px solid #222; text-align: center; }

        .view { display: none; }
        .active-view { display: block; }
    </style>
</head>
<body>

    <div id="resultPopup">
        <h1 id="popTitle">WIN!</h1>
        <h2 id="popAmount" style="color:gold;">+ 0 KRW</h2>
        <button class="btn-play" onclick="closePopup()">í™•ì¸</button>
    </div>

    <div class="top-nav">
        <div class="logo" onclick="showView('lobby')">S SUPER 9 BET</div>
        <div class="asset-box">KRW <span id="assetVal">0</span></div>
    </div>

    <div class="main-wrapper">
        <div class="sidebar">
            <div id="m-lobby" class="menu-item menu-active" onclick="showView('lobby')">ğŸ  ë©”ì¸ ë¡œë¹„</div>
            <div id="m-slot" class="menu-item" onclick="showView('slotView')">ğŸ° í”„ë¦¬ë¯¸ì—„ ìŠ¬ë¡¯</div>
            <div id="m-bac" class="menu-item" onclick="showView('bacView')">ğŸƒ VIP ë°”ì¹´ë¼</div>
            <div id="m-snail" class="menu-item" onclick="showView('snailView')">ğŸŒ ì‹¤ì‚¬ ë‹¬íŒ½ì´</div>
            <div id="m-cs" class="menu-item" onclick="showView('csCenter')">ğŸ§ ê³ ê°ì„¼í„°</div>
        </div>

        <div class="content">
            <div id="lobby" class="view active-view">
                <div class="ad-banner">
                    <div class="ad-item" style="background:#400; color:#fff;">âš ï¸ [ê³µì§€] ì…ê¸ˆì „ ê³„ì¢Œí™•ì¸ í•„ìˆ˜! âš ï¸</div>
                    <div class="ad-item" style="background:#004; color:#0cf; border-color:#00f;">ğŸ’ ì‹ ê·œ ì²«ì¶© 30% / ë§¤ì¶© 15% ğŸ’</div>
                </div>
                <div class="game-panel">
                    <h2 style="color:gold;">WELCOME TO SUPER 9</h2>
                    <p>ìµœê³ ì˜ ìë³¸ë ¥ê³¼ ì‹ ë¢°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìš´ì˜ë˜ëŠ” ë©”ì´ì € ì¹´ì§€ë…¸ì…ë‹ˆë‹¤.</p>
                </div>
            </div>

            <div id="slotView" class="view">
                <div class="game-panel">
                    <h2>ğŸ° CASINO 777 SLOT</h2>
                    <div class="slot-machine">
                        <div class="reel"><div id="reel1" class="reel-img-container"></div></div>
                        <div class="reel"><div id="reel2" class="reel-img-container"></div></div>
                        <div class="reel"><div id="reel3" class="reel-img-container"></div></div>
                    </div>
                    <input type="number" id="slotBet" class="bet-input" value="10000"><br>
                    <button id="slotBtn" class="btn-play" onclick="playSlot()">SPIN START</button>
                </div>
            </div>

            <div id="bacView" class="view">
                <div class="game-panel">
                    <h2>ğŸƒ VIP BACCARAT</h2>
                    <div class="bac-table">
                        <div id="playerArea">
                            <p style="color:#4facfe; font-weight:900;">PLAYER <span id="pScore"></span></p>
                            <div id="pC1" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                            <div id="pC2" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                        </div>
                        <div id="bankerArea">
                            <p style="color:#ff5252; font-weight:900;">BANKER <span id="bScore"></span></p>
                            <div id="bC1" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                            <div id="bC2" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                        </div>
                    </div>
                    <input type="number" id="bacBet" class="bet-input" value="10000"><br>
                    <div style="display:flex; justify-content:center; gap:10px; margin-top:15px;">
                        <button class="btn-play" style="background:#4facfe; color:#fff;" onclick="playBac('player')">PLAYER</button>
                        <button class="btn-play" style="background:#4caf50; color:#fff;" onclick="playBac('tie')">TIE</button>
                        <button class="btn-play" style="background:#ff5252; color:#fff;" onclick="playBac('banker')">BANKER</button>
                    </div>
                </div>
            </div>

            <div id="snailView" class="view">
                <div class="game-panel">
                    <h2>ğŸŒ REAL SNAIL RACING</h2>
                    <canvas id="snailCanvas" width="700" height="250" style="background:url('https://t3.ftcdn.net/jpg/02/76/54/12/360_F_276541249_1E7Rpxqf0O8M5h8vN9zW4TfS8V7S5S5I.jpg') center/cover; border-radius:15px;"></canvas>
                    <div style="margin:20px 0;">
                        <label><input type="radio" name="snailPick" value="0" checked> 1ë²ˆ</label>
                        <label style="margin-left:20px;"><input type="radio" name="snailPick" value="1"> 2ë²ˆ</label>
                        <label style="margin-left:20px;"><input type="radio" name="snailPick" value="2"> 3ë²ˆ</label>
                    </div>
                    <input type="number" id="snailBet" class="bet-input" value="10000"><br>
                    <button id="snailBtn" class="btn-play" onclick="playSnail()">RACE START</button>
                </div>
            </div>

            <div id="csCenter" class="view">
                <div class="game-panel" style="text-align:left;">
                    <h2>1:1 ë¬¸ì˜ì„¼í„° <span id="adminTag" style="display:none; color:gold; font-size:12px;">[ADMIN]</span></h2>
                    <div style="background:#000; padding:15px; border-radius:10px; margin-bottom:20px;">
                        <input type="text" id="csTitle" placeholder="ì œëª©" style="width:100%; margin-bottom:10px; padding:8px; background:#111; color:#fff; border:1px solid #333;">
                        <textarea id="csContent" placeholder="ë¬¸ì˜ ë‚´ìš©" style="width:100%; height:80px; background:#111; color:#fff; border:1px solid #333; padding:8px;"></textarea>
                        <div style="margin-top:10px; display:flex; justify-content:space-between;">
                            <label><input type="checkbox" id="csSecret"> ë¹„ë°€ê¸€</label>
                            <button class="btn-play" style="padding:8px 20px; margin:0;" onclick="writeCS()">ë“±ë¡</button>
                        </div>
                    </div>
                    <table class="cs-table">
                        <thead><tr><th>ìƒíƒœ</th><th>ì œëª©</th><th>ì‘ì„±ì</th><th>ê´€ë¦¬</th></tr></thead>
                        <tbody id="csList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, collection, addDoc, getDocs, query, orderBy, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4", authDomain: "gambling-23339.firebaseapp.com", projectId: "gambling-23339", storageBucket: "gambling-23339.firebasestorage.app", messagingSenderId: "1031894079454", appId: "1:1031894079454:web:960ca0f1748493cdd9af4f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userObj = null, isAdmin = false, curBal = 0;

        // ë¡œê·¸ì¸ ìœ ì§€ ë° ìì‚° ì—…ë°ì´íŠ¸
        onAuthStateChanged(auth, async (user) => {
            if(user) {
                userObj = user;
                const snap = await getDoc(doc(db, "users", user.uid));
                const data = snap.data();
                isAdmin = data.role === 'admin';
                if(isAdmin) document.getElementById('adminTag').style.display = 'inline';
                updateAsset();
                initSlotIcons();
            } else { location.href = "login.html"; }
        });

        async function updateAsset() {
            const snap = await getDoc(doc(db, "users", userObj.uid));
            curBal = snap.data().balance;
            document.getElementById('assetVal').innerText = curBal.toLocaleString();
        }

        window.showView = (vid) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('menu-active'));
            document.getElementById(vid).classList.add('active-view');
            document.getElementById('m-'+vid.replace('View','').replace('Center','cs')).classList.add('menu-active');
            if(vid === 'csCenter') loadCS();
            if(vid === 'snailView') initSnail();
        };

        // --- ê²°ê³¼ íŒì—… ---
        function openPopup(win, amount) {
            const p = document.getElementById('resultPopup');
            document.getElementById('popTitle').className = win ? 'win-title' : 'lose-title';
            document.getElementById('popTitle').innerText = win ? 'VICTORY!' : 'DEFEAT';
            document.getElementById('popAmount').innerText = (amount >= 0 ? '+' : '') + amount.toLocaleString() + " KRW";
            p.style.display = 'block';
        }
        window.closePopup = () => document.getElementById('resultPopup').style.display = 'none';

        // --- ìŠ¬ë¡¯ ì‹œìŠ¤í…œ (ì‹¤ë¬¼ ì´ë¯¸ì§€ ë¦´) ---
        const icons = [
            'https://cdn-icons-png.flaticon.com/512/8141/8141830.png', // 7
            'https://cdn-icons-png.flaticon.com/512/3242/3242008.png', // Cherry
            'https://cdn-icons-png.flaticon.com/512/1045/1045508.png', // Diamond
            'https://cdn-icons-png.flaticon.com/512/1656/1656858.png'  // Bar
        ];
        function initSlotIcons() {
            [1,2,3].forEach(id => {
                const r = document.getElementById('reel'+id);
                r.innerHTML = '';
                for(let i=0; i<30; i++) {
                    const img = document.createElement('img');
                    img.src = icons[Math.floor(Math.random()*4)];
                    img.style.width = '100%'; img.style.height = '120px';
                    r.appendChild(img);
                }
            });
        }
        window.playSlot = async () => {
            const bet = parseInt(document.getElementById('slotBet').value);
            if(bet > curBal || bet <= 0) return alert("ë¨¸ë‹ˆ ë¶€ì¡±");
            document.getElementById('slotBtn').disabled = true;

            [1,2,3].forEach((id, idx) => {
                const r = document.getElementById('reel'+id);
                r.style.transition = `top ${2 + idx}s cubic-bezier(0.45, 0.05, 0.55, 0.95)`;
                const finalPos = -(Math.floor(Math.random()*15 + 5) * 120);
                r.style.top = finalPos + "px";
                if(idx === 2) {
                    setTimeout(async () => {
                        const win = Math.random() > 0.7; // 30% í™•ë¥  ë‹¹ì²¨
                        const profit = win ? (bet * 5) - bet : -bet;
                        await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit) });
                        updateAsset();
                        openPopup(win, profit);
                        document.getElementById('slotBtn').disabled = false;
                        setTimeout(() => { [1,2,3].forEach(i=> { document.getElementById('reel'+i).style.transition='none'; document.getElementById('reel'+i).style.top='0'; }); }, 1000);
                    }, 4000);
                }
            });
        };

        // --- ë°”ì¹´ë¼ ì‹œìŠ¤í…œ (ì‹¤ì œ ì¹´ë“œ ì´ë¯¸ì§€) ---
        window.playBac = async (pick) => {
            const bet = parseInt(document.getElementById('bacBet').value);
            if(bet > curBal || bet <= 0) return alert("ë¨¸ë‹ˆ ë¶€ì¡±");

            const slots = ['pC1', 'pC2', 'bC1', 'bC2'];
            slots.forEach(s => document.querySelector(`#${s} .card-inner`).classList.remove('flipped'));
            
            const getC = () => {
                const n = Math.floor(Math.random()*13)+1;
                const s = ['H','S','D','C'][Math.floor(Math.random()*4)];
                let char = n===1?'A':n===11?'J':n===12?'Q':n===13?'K':n===10?'0':n;
                return { v: n > 10 ? 0 : n, url: `https://deckofcardsapi.com/static/img/${char}${s}.png` };
            };

            const cards = [getC(), getC(), getC(), getC()];
            for(let i=0; i<4; i++) {
                await new Promise(r => setTimeout(r, 800));
                document.querySelector(`#${slots[i]} .card-front`).style.backgroundImage = `url(${cards[i].url})`;
                document.querySelector(`#${slots[i]} .card-inner`).classList.add('flipped');
            }

            const pS = (cards[0].v + cards[2].v) % 10;
            const bS = (cards[1].v + cards[3].v) % 10;
            const win = pS > bS ? 'player' : (bS > pS ? 'banker' : 'tie');
            const profit = (pick === win) ? (win === 'tie' ? bet * 9 : bet * 2.8) - bet : -bet;

            setTimeout(async () => {
                await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit) });
                updateAsset();
                openPopup(profit > 0, profit);
            }, 500);
        };

        // --- ë‹¬íŒ½ì´ ê²½ì£¼ (ì‹¤ì‚¬ ìº”ë²„ìŠ¤) ---
        let snX = [10, 10, 10];
        const snImg = new Image(); snImg.src = "https://cdn-icons-png.flaticon.com/512/2823/2823377.png";
        window.initSnail = () => {
            const ctx = document.getElementById('snailCanvas').getContext('2d');
            function frame() {
                ctx.clearRect(0,0,700,250);
                snX.forEach((x, i) => { ctx.drawImage(snImg, x, 20 + (i*75), 70, 50); });
                requestAnimationFrame(frame);
            }
            frame();
        };
        window.playSnail = async () => {
            const bet = parseInt(document.getElementById('snailBet').value);
            const pick = parseInt(document.querySelector('input[name="snailPick"]:checked').value);
            document.getElementById('snailBtn').disabled = true;
            const race = setInterval(async () => {
                let winner = -1;
                snX = snX.map((x, i) => {
                    const nx = x + Math.random() * 3.5;
                    if(nx > 620) winner = i;
                    return nx;
                });
                if(winner !== -1) {
                    clearInterval(race);
                    const win = (winner === pick);
                    const profit = win ? (bet * 2.8) - bet : -bet;
                    await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit) });
                    updateAsset();
                    openPopup(win, profit);
                    snX = [10,10,10]; document.getElementById('snailBtn').disabled = false;
                }
            }, 40);
        };

        // --- ê³ ê°ì„¼í„° (ê´€ë¦¬ì ê¸°ëŠ¥ í¬í•¨) ---
        window.writeCS = async () => {
            const title = document.getElementById('csTitle').value;
            const content = document.getElementById('csContent').value;
            if(!title || !content) return;
            await addDoc(collection(db, "cs"), { uid: userObj.uid, email: userObj.email, title, content, secret: document.getElementById('csSecret').checked, time: new Date().toISOString() });
            document.getElementById('csTitle').value = ""; document.getElementById('csContent').value = "";
            loadCS();
        };

        window.loadCS = async () => {
            const q = query(collection(db, "cs"), orderBy("time", "desc"));
            const snap = await getDocs(q);
            document.getElementById('csList').innerHTML = snap.docs.map(docSnap => {
                const d = docSnap.data();
                const canSee = !d.secret || d.uid === userObj.uid || isAdmin;
                return `<tr>
                    <td>${d.secret ? 'ğŸ”’' : 'ğŸ“¢'}</td>
                    <td onclick="alert('${canSee ? d.content.replace(/\n/g,' ') : 'ë¹„ë°€ê¸€ì…ë‹ˆë‹¤.'}')" style="cursor:pointer;">${canSee ? d.title : 'ë¹„ë°€ê¸€ì…ë‹ˆë‹¤.'}</td>
                    <td>${d.email.split('@')[0]}</td>
                    <td>${isAdmin ? `<button onclick="deleteCS('${docSnap.id}')" style="color:red; background:none; border:none; cursor:pointer;">ì‚­ì œ</button>` : '-'}</td>
                </tr>`;
            }).join('');
        };

        window.deleteCS = async (id) => {
            if(confirm("ê¸€ì„ ì‚­ì œí• ê¹Œìš”?")) { await deleteDoc(doc(db, "cs", id)); loadCS(); }
        };
    </script>
</body>
</html>
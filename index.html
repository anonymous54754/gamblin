<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S SUPER 9 BET | ê³µì‹ ë¼ì´ë¸Œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main-green: #2e7d32; --point-gold: #eebb4d; --bg-dark: #0a0a0a; --card-w: 80px; --card-h: 115px; }
        body { background-color: var(--bg-dark); color: #eee; font-family: 'Noto Sans KR', sans-serif; margin: 0; overflow-x: hidden; }
        
        /* ìƒë‹¨ ìì‚° ë°” */
        .top-nav { background: linear-gradient(180deg, #4caf50 0%, #1b5e20 100%); height: 65px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; position: sticky; top:0; z-index: 1000; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .logo { font-size: 26px; font-weight: 900; font-style: italic; color: #fff; cursor: pointer; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .user-info { display: flex; align-items: center; gap: 20px; }
        .asset-box { background: rgba(0,0,0,0.6); padding: 8px 18px; border-radius: 25px; border: 1px solid var(--point-gold); font-weight: 900; color: var(--point-gold); }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-wrapper { display: flex; min-height: calc(100vh - 65px); }
        .sidebar { width: 230px; background: #111; border-right: 1px solid #222; padding-top: 20px; }
        .menu-item { padding: 18px 25px; cursor: pointer; font-size: 15px; transition: 0.3s; border-left: 4px solid transparent; }
        .menu-item:hover, .menu-active { background: #1a1a1a; border-left: 4px solid var(--point-gold); color: var(--point-gold); }
        .content { flex: 1; padding: 30px; background: #141414; }

        /* ë°”ì¹´ë¼ í…Œì´ë¸” ì—°ì¶œ */
        .bac-area { background: radial-gradient(circle, #1a5e20 0%, #0a2e10 100%); border: 10px solid #3e2723; border-radius: 120px; padding: 50px; display: flex; justify-content: center; gap: 60px; margin-bottom: 30px; }
        .card-slot { width: var(--card-w); height: var(--card-h); perspective: 1000px; display: inline-block; margin: 0 8px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 6px; }
        .card-back { background: url('https://deckofcardsapi.com/static/img/back.png') center/cover; }
        .card-front { background-size: cover; transform: rotateY(180deg); }
        .flipped { transform: rotateY(180deg); }

        /* ê²Œì„ ê³µí†µ UI */
        .bet-panel { background: #1e1e1e; padding: 25px; border-radius: 12px; border: 1px solid #333; text-align: center; }
        .input-group { display: flex; gap: 5px; max-width: 400px; margin: 0 auto 15px; }
        input { background: #000; border: 1px solid #444; color: var(--point-gold); padding: 12px; border-radius: 5px; flex: 1; font-weight: bold; font-size: 16px; }
        .btn-allin { background: #444; color: #fff; border: none; padding: 0 15px; cursor: pointer; border-radius: 5px; font-size: 12px; }
        .btn-play { background: var(--point-gold); color: #000; border: none; padding: 15px 30px; font-weight: 900; border-radius: 5px; cursor: pointer; width: 100%; max-width: 400px; }

        /* ë‹¬íŒ½ì´ ìº”ë²„ìŠ¤ */
        #snailCanvas { background: url('https://images.unsplash.com/photo-1502082553048-f009c37129b9?auto=format&fit=crop&w=600&q=80') center/cover; border: 5px solid #2e1b0f; border-radius: 10px; width: 100%; max-width: 650px; }

        #loginOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.96); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .view { display: none; }
        .active-view { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div style="background:#1a1a1a; padding:45px; border:2px solid var(--main-green); border-radius:20px; width:340px; text-align:center;">
            <h1 style="color:var(--main-green); margin-bottom:30px; font-style:italic;">SUPER 9 BET</h1>
            <input type="email" id="loginEmail" placeholder="ì•„ì´ë””(ì´ë©”ì¼)" style="margin-bottom:12px; width:100%;">
            <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸" style="margin-bottom:25px; width:100%;">
            <button class="btn-play" style="max-width:100%;" onclick="login()">ì ‘ì†í•˜ê¸°</button>
        </div>
    </div>

    <div class="top-nav">
        <div class="logo" onclick="showView('lobby')">S SUPER 9 BET</div>
        <div class="user-info">
            <div class="asset-box">ë³´ìœ  ë¨¸ë‹ˆ: <span id="assetVal">0</span> KRW</div>
            <div style="font-size: 13px; font-weight: bold; color: #fff;">
                <span onclick="showView('myPage')" style="cursor:pointer; margin-right:15px;">ì •ë³´ê´€ë¦¬</span>
                <span onclick="showView('csCenter')" style="cursor:pointer; margin-right:15px;">ê³ ê°ë¬¸ì˜</span>
                <span onclick="logout()" style="cursor:pointer; color:#ff5252;">ë¡œê·¸ì•„ì›ƒ</span>
            </div>
        </div>
    </div>

    <div class="main-wrapper">
        <div class="sidebar">
            <div class="menu-item menu-active" onclick="showView('lobby')">ğŸ  ë©”ì¸ í™ˆ</div>
            <div class="menu-item" onclick="showView('slotView')">ğŸ° ê³¼ì¼ ìŠ¬ë¡¯</div>
            <div class="menu-item" onclick="showView('bacView')">ğŸƒ VIP ë°”ì¹´ë¼</div>
            <div class="menu-item" onclick="showView('snailView')">ğŸŒ ì‹¤ì‚¬ ë‹¬íŒ½ì´</div>
        </div>

        <div class="content">
            <div id="lobby" class="view active-view">
                <h2 style="color:var(--point-gold);">ğŸ“¢ ì‹¤ì‹œê°„ ì­íŒŸ ì˜ˆê³ </h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <div style="background:linear-gradient(45deg, #400, #000); padding:30px; border-radius:10px; border:1px solid #600;">ìŠ¬ë¡¯ë¨¸ì‹  777 ë‹¹ì²¨ ì‹œ<br><strong>ë°°íŒ…ê¸ˆì˜ 17.7ë°° ì¦‰ì‹œ ì§€ê¸‰</strong></div>
                    <div style="background:linear-gradient(45deg, #004, #000); padding:30px; border-radius:10px; border:1px solid #006;">ë°”ì¹´ë¼ ì¹´ë“œ ë”œë§<br><strong>ê°€ì¥ í˜„ì‹¤ì ì¸ 3D ëª¨ì…˜ ì ìš©</strong></div>
                </div>
            </div>

            <div id="slotView" class="view">
                <div class="bet-panel">
                    <h2 style="color:var(--point-gold)">FRUITS 777 SLOTS</h2>
                    <div id="reels" style="font-size:65px; background:#000; padding:30px; border-radius:15px; margin:20px 0; border:2px solid #333;">ğŸ‡ | ğŸ | ğŸ‡</div>
                    <div class="input-group">
                        <input type="number" id="slotBet" value="10000">
                        <button class="btn-allin" onclick="allIn('slotBet')">ALL-IN</button>
                    </div>
                    <button class="btn-play" onclick="playSlot()">SPIN START</button>
                </div>
            </div>

            <div id="bacView" class="view">
                <div class="bet-panel">
                    <h2 style="color:#fff">VIP LIVE BACCARAT</h2>
                    <div class="bac-area">
                        <div>
                            <p style="color:#4facfe; font-weight:bold;">PLAYER</p>
                            <div id="pC1" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                            <div id="pC2" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                        </div>
                        <div>
                            <p style="color:#ff5252; font-weight:bold;">BANKER</p>
                            <div id="bC1" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                            <div id="bC2" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div>
                        </div>
                    </div>
                    <div class="input-group">
                        <input type="number" id="bacBet" value="10000">
                        <button class="btn-allin" onclick="allIn('bacBet')">ALL-IN</button>
                    </div>
                    <div style="display:flex; justify-content:center; gap:10px;">
                        <button class="btn-play" style="background:#4facfe; width:130px;" onclick="playBac('player')">P (2ë°°)</button>
                        <button class="btn-play" style="background:#4caf50; width:130px;" onclick="playBac('tie')">T (10ë°°)</button>
                        <button class="btn-play" style="background:#ff5252; width:130px;" onclick="playBac('banker')">B (2ë°°)</button>
                    </div>
                </div>
            </div>

            <div id="snailView" class="view">
                <div class="bet-panel">
                    <h2 style="color:#fff">REAL SNAIL RACING</h2>
                    <canvas id="snailCanvas" width="600" height="200"></canvas>
                    <div style="margin:20px 0;">
                        <label><input type="radio" name="snailPick" value="0" checked> 1ë²ˆ ë‹¬íŒ½ì´</label>
                        <label><input type="radio" name="snailPick" value="1" style="margin-left:20px;"> 2ë²ˆ ë‹¬íŒ½ì´</label>
                        <label><input type="radio" name="snailPick" value="2" style="margin-left:20px;"> 3ë²ˆ ë‹¬íŒ½ì´</label>
                    </div>
                    <div class="input-group">
                        <input type="number" id="snailBet" value="10000">
                        <button class="btn-allin" onclick="allIn('snailBet')">ALL-IN</button>
                    </div>
                    <button class="btn-play" onclick="playSnail()">RACE START</button>
                </div>
            </div>

            <div id="csCenter" class="view">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2>1:1 ê³ ê°ë¬¸ì˜</h2>
                    <span id="adminBadge" style="display:none; color:var(--point-gold); font-size:12px; border:1px solid var(--point-gold); padding:3px 8px; border-radius:5px;">ADMIN MODE</span>
                </div>
                <div class="bet-panel" style="text-align:left;">
                    <input type="text" id="csTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" style="margin-bottom:10px;">
                    <textarea id="csContent" style="width:100%; height:100px; background:#000; color:#fff; border:1px solid #444; border-radius:5px; padding:10px; box-sizing:border-box;"></textarea>
                    <div style="margin-top:10px;">
                        <label><input type="checkbox" id="csSecret"> ë¹„ê³µê°œ ë¬¸ì˜</label>
                        <button class="btn-play" style="width:120px; float:right;" onclick="writeCS()">ë¬¸ì˜ë“±ë¡</button>
                    </div>
                    <div style="clear:both; margin-top:30px;"></div>
                    <table style="width:100%; border-collapse:collapse; font-size:13px;">
                        <thead style="background:#222;"><tr><th style="padding:12px;">ìƒíƒœ</th><th>ì œëª©</th><th>ì‘ì„±ì</th><th>ë‚ ì§œ</th><th>ê¸°ëŠ¥</th></tr></thead>
                        <tbody id="csTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, arrayUnion, collection, addDoc, getDocs, query, orderBy, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4", authDomain: "gambling-23339.firebaseapp.com", projectId: "gambling-23339", storageBucket: "gambling-23339.firebasestorage.app", messagingSenderId: "1031894079454", appId: "1:1031894079454:web:960ca0f1748493cdd9af4f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userObj = null;
        let isAdmin = false;
        let currentBalance = 0;

        // --- ì‹œìŠ¤í…œ í•¸ë“¤ëŸ¬ ---
        window.login = async () => {
            const email = document.getElementById('loginEmail').value;
            const pw = document.getElementById('loginPw').value;
            try { await signInWithEmailAndPassword(auth, email, pw); } catch(e) { alert("ë¡œê·¸ì¸ ì •ë³´ ë¶ˆì¼ì¹˜"); }
        };

        window.logout = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, async (user) => {
            if(user) {
                userObj = user;
                isAdmin = (user.email === 'bugye6816@gmail.com');
                document.getElementById('loginOverlay').style.display = 'none';
                if(isAdmin) document.getElementById('adminBadge').style.display = 'block';
                updateAsset();
                loadCS();
            } else {
                document.getElementById('loginOverlay').style.display = 'flex';
            }
        });

        async function updateAsset() {
            const snap = await getDoc(doc(db, "users", userObj.uid));
            currentBalance = snap.data().balance;
            document.getElementById('assetVal').innerText = currentBalance.toLocaleString();
        }

        window.allIn = (id) => document.getElementById(id).value = currentBalance;

        window.showView = (id) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('menu-active'));
            document.getElementById(id).classList.add('active-view');
            if(id === 'snailView') initSnail();
            updateAsset();
        };

        // --- ë°”ì¹´ë¼ (í˜„ì‹¤ì  ì†ë„ & ëª¨ì…˜) ---
        window.playBac = async (pick) => {
            const bet = parseInt(document.getElementById('bacBet').value);
            if(bet > currentBalance || bet <= 0) return alert("ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");

            // ì¹´ë“œ ì´ˆê¸°í™”
            const slots = ['pC1', 'pC2', 'bC1', 'bC2'];
            slots.forEach(s => document.querySelector(`#${s} .card-inner`).classList.remove('flipped'));
            await new Promise(r => setTimeout(r, 600));

            const getCard = () => {
                const n = Math.floor(Math.random()*13)+1;
                const s = ['H','S','D','C'][Math.floor(Math.random()*4)];
                let v = n > 10 ? 0 : n;
                let c = n===1 ? 'A' : (n===11 ? 'J' : (n===12 ? 'Q' : (n===13 ? 'K' : (n===10 ? '0' : n))));
                return { v, url: `https://deckofcardsapi.com/static/img/${c}${s}.png` };
            };

            const p1 = getCard(), p2 = getCard(), b1 = getCard(), b2 = getCard();
            const deck = [p1, b1, p2, b2];

            for(let i=0; i<4; i++) {
                document.querySelector(`#${slots[i]} .card-front`).style.backgroundImage = `url(${deck[i].url})`;
                document.querySelector(`#${slots[i]} .card-inner`).classList.add('flipped');
                await new Promise(r => setTimeout(r, 1000)); // ë”œë§ ì†ë„ 1ì´ˆë¡œ ëŠ¦ì¶¤
            }

            const pSum = (p1.v + p2.v) % 10;
            const bSum = (b1.v + b2.v) % 10;
            const win = pSum > bSum ? 'player' : (bSum > pSum ? 'banker' : 'tie');
            const multi = (pick === win) ? (win === 'tie' ? 10 : 2) : 0;
            const profit = (bet * multi) - bet;

            await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit), history: arrayUnion({ game:'ë°”ì¹´ë¼', bet, profit, time: new Date().toISOString() }) });
            updateAsset();
            alert(`[ë°”ì¹´ë¼ ê²°ê³¼]\ní”Œë ˆì´ì–´(${pSum}) vs ë±…ì»¤(${bSum})\n${win.toUpperCase()} ìŠ¹ë¦¬! (${profit.toLocaleString()}ì› ì •ì‚°)`);
        };

        // --- ë‹¬íŒ½ì´ (ì‹¤ì‚¬ ì´ë¯¸ì§€ & íŒì—…) ---
        const snailPhoto = new Image(); 
        snailPhoto.src = "https://images.unsplash.com/photo-1599490659213-e2b9527bd087?auto=format&fit=crop&w=100&q=80"; // ì‹¤ì‚¬ ë‹¬íŒ½ì´
        let snailPos = [10, 10, 10];

        window.initSnail = () => {
            const ctx = document.getElementById('snailCanvas').getContext('2d');
            function animate() {
                ctx.clearRect(0,0,600,200);
                // íŠ¸ë™ êµ¬ë¶„ì„ 
                ctx.strokeStyle = "rgba(255,255,255,0.2)";
                for(let i=1; i<3; i++){ ctx.beginPath(); ctx.moveTo(0, i*66); ctx.lineTo(600, i*66); ctx.stroke(); }
                // ë‹¬íŒ½ì´ ê·¸ë¦¬ê¸°
                snailPos.forEach((x, i) => ctx.drawImage(snailPhoto, x, i*66 + 8, 50, 50));
                requestAnimationFrame(animate);
            }
            animate();
        };

        window.playSnail = async () => {
            const bet = parseInt(document.getElementById('snailBet').value);
            const pick = parseInt(document.querySelector('input[name="snailPick"]:checked').value);
            if(bet > currentBalance || bet <= 0) return alert("ì”ì•¡ ë¶€ì¡±");

            const timer = setInterval(async () => {
                let winner = -1;
                snailPos = snailPos.map((x, i) => {
                    const nx = x + Math.random() * 2.5; // ì†ë„ í•˜í–¥
                    if(nx >= 540) winner = i;
                    return nx;
                });
                if(winner !== -1) {
                    clearInterval(timer);
                    const isWin = winner === pick;
                    const profit = isWin ? Math.floor(bet * 2.9) - bet : -bet;
                    await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit), history: arrayUnion({ game:'ë‹¬íŒ½ì´', bet, profit, time: new Date().toISOString() }) });
                    alert(`[ë‹¬íŒ½ì´ ê²°ê³¼]\n${winner+1}ë²ˆ ë‹¬íŒ½ì´ ìš°ìŠ¹!\në‹¹ì²¨ê¸ˆ: ${(isWin?bet*2.9:0).toLocaleString()}ì›`);
                    snailPos = [10, 10, 10]; updateAsset();
                }
            }, 40);
        };

        // --- ìŠ¬ë¡¯ (ê²°ê³¼ íŒì—… ì¶”ê°€) ---
        const items = ['ğŸ','ğŸŠ','ğŸ‡','ğŸ’','ğŸ’','7ï¸âƒ£','ğŸ‰','ğŸ‹','ğŸ’°'];
        window.playSlot = async () => {
            const bet = parseInt(document.getElementById('slotBet').value);
            if(bet > currentBalance || bet <= 0) return alert("ì”ì•¡ ë¶€ì¡±");

            const res = [items[Math.floor(Math.random()*9)], items[Math.floor(Math.random()*9)], items[Math.floor(Math.random()*9)]];
            document.getElementById('reels').innerText = res.join(' | ');
            
            let multi = 0;
            if(res[0] === res[1] && res[1] === res[2]) multi = (res[0] === '7ï¸âƒ£') ? 17.7 : 5;
            else if(res[0] === res[1] || res[1] === res[2] || res[0] === res[2]) multi = 1;

            const profit = Math.floor(bet * multi) - bet;
            await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit), history: arrayUnion({ game:'ìŠ¬ë¡¯', bet, profit, time: new Date().toISOString() }) });
            updateAsset();
            alert(`[ìŠ¬ë¡¯ ê²°ê³¼]\nê²°ê³¼: ${res.join(' ')}\në°°ë‹¹: ${multi}ë°°\nìˆ˜ìµ: ${profit.toLocaleString()}ì›`);
        };

        // --- ê³ ê°ì„¼í„° (ê´€ë¦¬ì ê¶Œí•œ) ---
        window.writeCS = async () => {
            const title = document.getElementById('csTitle').value;
            const content = document.getElementById('csContent').value;
            const secret = document.getElementById('csSecret').checked;
            if(!title || !content) return alert("ë‚´ìš© ì…ë ¥ í•„ìˆ˜");
            await addDoc(collection(db, "cs"), { uid: userObj.uid, email: userObj.email, title, content, secret, time: new Date().toISOString() });
            loadCS();
        };

        window.delPost = async (id) => { if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { await deleteDoc(doc(db, "cs", id)); loadCS(); } };

        async function loadCS() {
            const q = query(collection(db, "cs"), orderBy("time", "desc"));
            const snap = await getDocs(q);
            document.getElementById('csTableBody').innerHTML = snap.docs.map(docSnap => {
                const d = docSnap.data();
                const canSee = !d.secret || d.uid === userObj.uid || isAdmin;
                return `<tr>
                    <td style="padding:12px;">${d.secret ? 'ğŸ”’' : 'ğŸ“¢'}</td>
                    <td onclick="alert('${canSee ? d.content : 'ë¹„ë°€ê¸€ì…ë‹ˆë‹¤'}')" style="cursor:pointer">${canSee ? d.title : 'ë¹„ë°€ê¸€ì…ë‹ˆë‹¤'}</td>
                    <td>${d.email.split('@')[0]}</td>
                    <td>${d.time.slice(5,10)}</td>
                    <td>${isAdmin ? `<button onclick="delPost('${docSnap.id}')">ì‚­ì œ</button>` : '-'}</td>
                </tr>`;
            }).join('');
        }

    </script>
</body>
</html>
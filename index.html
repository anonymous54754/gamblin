<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S SUPER 9 BET | ADMIN ENHANCED</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --main-green: #2e7d32; --point-gold: #eebb4d; --bg-dark: #0a0a0a; --panel-bg: #1a1a1a; --card-w: 80px; --card-h: 115px; }
        body { background-color: var(--bg-dark); color: #eee; font-family: 'Noto Sans KR', sans-serif; margin: 0; overflow-x: hidden; }
        
        .win-flash { animation: gold-glow 0.8s ease-out; }
        @keyframes gold-glow { 0% { box-shadow: inset 0 0 100px var(--point-gold); } 100% { box-shadow: inset 0 0 0 transparent; } }

        .top-nav { background: linear-gradient(180deg, #4caf50 0%, #1b5e20 100%); height: 65px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; position: sticky; top:0; z-index: 1000; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .logo { font-size: 26px; font-weight: 900; font-style: italic; color: #fff; cursor: pointer; }
        .sound-toggle { background: rgba(0,0,0,0.4); padding: 5px 12px; border-radius: 20px; font-size: 12px; cursor: pointer; border: 1px solid #fff; display: flex; align-items: center; gap: 8px; }
        .sound-on { color: var(--point-gold); border-color: var(--point-gold); }
        .asset-box { background: rgba(0,0,0,0.6); padding: 8px 18px; border-radius: 25px; border: 1px solid var(--point-gold); font-weight: 900; color: var(--point-gold); }

        .main-wrapper { display: flex; min-height: calc(100vh - 65px); }
        .sidebar { width: 230px; background: #111; border-right: 1px solid #222; padding-top: 20px; }
        .menu-item { padding: 18px 25px; cursor: pointer; font-size: 14px; border-left: 4px solid transparent; transition: 0.3s; color: #aaa; }
        .menu-item:hover, .menu-active { background: #1a1a1a; border-left: 4px solid var(--point-gold); color: var(--point-gold); }
        .content { flex: 1; padding: 30px; background: #141414; }

        .bet-panel { background: var(--panel-bg); padding: 25px; border-radius: 15px; border: 1px solid #333; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn-play { background: var(--point-gold); color: #000; border: none; padding: 15px 30px; font-weight: 900; border-radius: 5px; cursor: pointer; box-shadow: 0 4px 0 #b8860b; }
        .btn-play:active { transform: translateY(3px); box-shadow: none; }
        input, textarea { background: #000; border: 1px solid #444; color: var(--point-gold); padding: 12px; border-radius: 5px; font-weight: 900; }

        .custom-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #111; font-size: 13px; }
        .custom-table th { background: #222; color: var(--point-gold); padding: 12px; }
        .custom-table td { padding: 12px; border-bottom: 1px solid #222; text-align: center; }
        .del-btn { background: #ff5252; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 11px; }

        .view { display: none; }
        .active-view { display: block; }
    </style>
</head>
<body id="mainBody">

    <div class="top-nav">
        <div style="display:flex; align-items:center; gap:20px;">
            <div class="logo" onclick="showView('lobby')">S SUPER 9 BET</div>
            <div id="soundBtn" class="sound-toggle" onclick="toggleSound()">ğŸ”‡ ì‚¬ìš´ë“œ OFF</div>
        </div>
        <div style="display:flex; align-items:center; gap:20px;">
            <div class="asset-box">ë³´ìœ ë¨¸ë‹ˆ: <span id="assetVal">0</span></div>
            <div style="font-size: 12px; font-weight: 700;">
                <span onclick="showView('myPage')" style="cursor:pointer; margin-right:12px;">ì •ë³´ê´€ë¦¬</span>
                <span onclick="showView('csCenter')" style="cursor:pointer; margin-right:12px;">ê³ ê°ì„¼í„°</span>
                <span onclick="logout()" style="cursor:pointer; color:#ff5252;">ë¡œê·¸ì•„ì›ƒ</span>
            </div>
        </div>
    </div>

    <div class="main-wrapper">
        <div class="sidebar">
            <div class="menu-item menu-active" onclick="showView('lobby')">ğŸ  ë©”ì¸ ë¡œë¹„</div>
            <div class="menu-item" onclick="showView('slotView')">ğŸ° 777 ìŠ¬ë¡¯</div>
            <div class="menu-item" onclick="showView('bacView')">ğŸƒ VIP ë°”ì¹´ë¼</div>
            <div class="menu-item" onclick="showView('snailView')">ğŸŒ ì‹¤ì‚¬ ë‹¬íŒ½ì´</div>
        </div>

        <div class="content">
            <div id="lobby" class="view active-view">
                <div class="bet-panel">
                    <h2 style="color:var(--point-gold);">PREMIUM LIVE CASINO</h2>
                    <p>ìƒë‹¨ ë©”ë‰´ë¥¼ ì„ íƒí•˜ì—¬ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
                </div>
            </div>

            <div id="slotView" class="view">
                <div class="bet-panel">
                    <h2 style="letter-spacing:10px;">JACKPOT 777</h2>
                    <div id="reels" style="font-size:70px; margin:40px 0; background:#000; padding:30px; border-radius:15px; border:2px solid #333; min-height:100px;">ğŸ’ | ğŸ’ | ğŸ’</div>
                    <div style="margin-bottom:20px;">
                        <input type="number" id="slotBet" value="10000">
                        <button class="btn-allin" onclick="allIn('slotBet')" style="padding:12px; cursor:pointer; background:#444; color:white; border:none; border-radius:5px;">ALL-IN</button>
                    </div>
                    <button id="slotBtn" class="btn-play" style="width:100%; max-width:400px;" onclick="playSlot()">SPIN START</button>
                </div>
            </div>

            <div id="csCenter" class="view">
                <div class="bet-panel" style="text-align:left;">
                    <h2>1:1 ë¬¸ì˜ì„¼í„° <span id="adminBadge" style="display:none; color:gold; font-size:14px; margin-left:10px;">[ADMIN MODE]</span></h2>
                    
                    <div style="background:#000; padding:20px; border-radius:10px; margin-bottom:20px;">
                        <input type="text" id="csTitle" placeholder="ì œëª©" style="width:100%; margin-bottom:10px; box-sizing:border-box;">
                        <textarea id="csContent" placeholder="ë‚´ìš©" style="width:100%; height:80px; background:#111; color:#fff; border:1px solid #333; padding:10px; box-sizing:border-box;"></textarea>
                        <div style="margin-top:10px; display:flex; justify-content:space-between; align-items:center;">
                            <label style="font-size:13px; cursor:pointer;"><input type="checkbox" id="csSecret"> ğŸ”’ ë¹„ë°€ê¸€ë¡œ ì‘ì„±</label>
                            <button class="btn-play" style="width:120px; padding:10px;" onclick="writeCS()">ë“±ë¡í•˜ê¸°</button>
                        </div>
                    </div>

                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th>ìƒíƒœ</th>
                                <th>ì œëª©</th>
                                <th>ì‘ì„±ì</th>
                                <th id="adminTh" style="display:none;">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="csTableBody">
                            <tr><td colspan="4" style="color:#666;">ë¬¸ì˜ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            </div>
    </div>

    <audio id="sndClick" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>
    <audio id="sndReveal" src="https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3"></audio>
    <audio id="sndWin" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, arrayUnion, collection, addDoc, getDocs, query, orderBy, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4", authDomain: "gambling-23339.firebaseapp.com", projectId: "gambling-23339", storageBucket: "gambling-23339.firebasestorage.app", messagingSenderId: "1031894079454", appId: "1:1031894079454:web:960ca0f1748493cdd9af4f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userObj = null, isAdmin = false, curBal = 0, soundEnabled = false;

        // ì‚¬ìš´ë“œ í† ê¸€
        window.toggleSound = () => {
            soundEnabled = !soundEnabled;
            document.getElementById('soundBtn').innerText = soundEnabled ? "ğŸ”Š ì‚¬ìš´ë“œ ON" : "ğŸ”‡ ì‚¬ìš´ë“œ OFF";
            document.getElementById('soundBtn').classList.toggle('sound-on');
        };
        const playSnd = (id) => { if(soundEnabled) { const s = document.getElementById(id); s.currentTime = 0; s.play(); } };

        // ë¨¸ë‹ˆ ì• ë‹ˆë©”ì´ì…˜
        const animateValue = (id, start, end, duration) => {
            const obj = document.getElementById(id);
            let startT = null;
            const step = (t) => {
                if (!startT) startT = t;
                const progress = Math.min((t - startT) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        };

        // ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€ ë° ê´€ë¦¬ì í™•ì¸
        onAuthStateChanged(auth, async (user) => {
            if(user) { 
                userObj = user;
                // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ (ì‚¬ìš©ì ë¬¸ì„œì˜ role í•„ë“œ ì²´í¬)
                const userSnap = await getDoc(doc(db, "users", user.uid));
                if(userSnap.exists() && userSnap.data().role === 'admin') {
                    isAdmin = true;
                    document.getElementById('adminBadge').style.display = 'inline';
                    document.getElementById('adminTh').style.display = 'table-cell';
                }
                updateAsset(); 
                loadCS(); // ë¡œê·¸ì¸ í™•ì¸ ì¦‰ì‹œ ëª©ë¡ ë¡œë“œ
            }
        });

        // ìì‚° ì—…ë°ì´íŠ¸
        async function updateAsset() {
            const snap = await getDoc(doc(db, "users", userObj.uid));
            if(snap.exists()){
                const nB = snap.data().balance;
                animateValue("assetVal", curBal, nB, 1000);
                curBal = nB;
            }
        }

        // ë·° ì „í™˜
        window.showView = (vid) => {
            playSnd('sndClick');
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('menu-active'));
            document.getElementById(vid).classList.add('active-view');
            if(vid === 'csCenter') loadCS(); // íƒ­ í´ë¦­ ì‹œì—ë„ ìµœì‹  ê¸€ ë¡œë“œ
        };

        // ê³ ê°ì„¼í„°: ê¸€ ì“°ê¸°
        window.writeCS = async () => {
            const title = document.getElementById('csTitle').value;
            const content = document.getElementById('csContent').value;
            if(!title || !content) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            playSnd('sndClick');
            try {
                await addDoc(collection(db, "cs"), { 
                    uid: userObj.uid, 
                    email: userObj.email, 
                    title: title, 
                    content: content, 
                    secret: document.getElementById('csSecret').checked, 
                    time: new Date().toISOString() 
                });
                document.getElementById('csTitle').value = "";
                document.getElementById('csContent').value = "";
                loadCS();
                alert("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } catch(e) { alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); }
        };

        // ê³ ê°ì„¼í„°: ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ê´€ë¦¬ì ê¸°ëŠ¥ í¬í•¨)
        async function loadCS() {
            try {
                const q = query(collection(db, "cs"), orderBy("time", "desc"));
                const snap = await getDocs(q);
                const tbody = document.getElementById('csTableBody');
                
                if (snap.empty) {
                    tbody.innerHTML = '<tr><td colspan="4" style="color:#666;">ë“±ë¡ëœ ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    return;
                }

                tbody.innerHTML = snap.docs.map(docSnap => {
                    const d = docSnap.data();
                    const isMyPost = (d.uid === userObj?.uid);
                    const canView = !d.secret || isMyPost || isAdmin;
                    
                    return `
                        <tr>
                            <td>${d.secret ? 'ğŸ”’' : 'ğŸ“¢'}</td>
                            <td onclick="viewPost('${canView}', '${d.content.replace(/\n/g, "\\n")}')" style="cursor:pointer; text-align:left; color:${canView?'#eee':'#666'}">
                                ${canView ? d.title : 'ë¹„ë°€ê¸€ì…ë‹ˆë‹¤.'}
                            </td>
                            <td>${d.email ? d.email.split('@')[0] : 'ìµëª…'}</td>
                            ${isAdmin ? `<td><button class="del-btn" onclick="deletePost('${docSnap.id}')">ì‚­ì œ</button></td>` : d.uid === userObj?.uid ? '<td>-</td>' : ''}
                        </tr>
                    `;
                }).join('');
            } catch(e) { console.error(e); }
        }

        // ê³ ê°ì„¼í„°: ê¸€ ë³´ê¸° í•¨ìˆ˜
        window.viewPost = (canView, content) => {
            if(canView === 'true') alert(content);
            else alert("ë¹„ë°€ê¸€ì…ë‹ˆë‹¤. ì‘ì„±ìë§Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        };

        // ê³ ê°ì„¼í„°: ì‚­ì œ í•¨ìˆ˜ (ê´€ë¦¬ ì „ìš©)
        window.deletePost = async (postId) => {
            if(!isAdmin) return;
            if(confirm("ì •ë§ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                await deleteDoc(doc(db, "cs", postId));
                alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                loadCS();
            }
        };

        // ìŠ¬ë¡¯ ë¨¸ë‹ˆ ë² íŒ… í•¨ìˆ˜
        window.allIn = (id) => { 
            playSnd('sndClick'); 
            document.getElementById(id).value = curBal; 
        };

        // ìŠ¬ë¡¯ ë¡œì§ (ìƒëµëœ ë¶€ë¶„ ìœ ì§€)
        const syms = ['ğŸ','ğŸŠ','ğŸ‡','ğŸ’','ğŸ’','7ï¸âƒ£','ğŸ’°'];
        window.playSlot = async () => {
            playSnd('sndClick');
            const betInput = document.getElementById('slotBet');
            const bet = parseInt(betInput.value);
            if(bet > curBal || bet <= 0) return alert("ë¨¸ë‹ˆ ë¶€ì¡±");

            document.getElementById('slotBtn').disabled = true;
            document.getElementById('reels').innerText = "ğŸ”„ | ğŸ”„ | ğŸ”„";

            setTimeout(async () => {
                const res = [syms[Math.floor(Math.random()*7)], syms[Math.floor(Math.random()*7)], syms[Math.floor(Math.random()*7)]];
                document.getElementById('reels').innerText = res.join(' | ');
                playSnd('sndReveal');

                let mul = 0;
                if(res[0] === res[1] && res[1] === res[2]) mul = (res[0] === '7ï¸âƒ£') ? 20 : 7;
                else if(res[0] === res[1] || res[1] === res[2] || res[0] === res[2]) mul = 1.5;

                const profit = Math.floor(bet * mul) - bet;
                if(profit > 0) {
                    playSnd('sndWin');
                    document.getElementById('mainBody').classList.add('win-flash');
                    setTimeout(()=>document.getElementById('mainBody').classList.remove('win-flash'), 800);
                }

                await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit), history: arrayUnion({ game:'ìŠ¬ë¡¯', bet, profit, time: new Date().toISOString() }) });
                updateAsset();
                document.getElementById('slotBtn').disabled = false;
            }, 1500);
        };
    </script>
</body>
</html>